---
const title = "Juego de Llantas - Gana un Auto!";
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    :root {
      --breick-purple: #6B2D7B;
      --breick-purple-dark: #4A1F56;
      --breick-purple-light: #8B4D9B;
      --breick-yellow: #FFB81C;
      --breick-yellow-light: #FFD54F;
      --breick-yellow-dark: #E6A000;
    }

    body {
      font-family: 'Press Start 2P', cursive;
      background: linear-gradient(135deg, var(--breick-purple-dark) 0%, var(--breick-purple) 50%, var(--breick-purple-dark) 100%);
      min-height: 100vh;
      color: #fff;
      image-rendering: pixelated;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0.5rem;
      height: 100%;
      overflow-y: auto;
    }

    .container.fullscreen {
      max-width: 100%;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 0;
      overflow: hidden;
    }

    header {
      text-align: center;
      padding: 0.5rem 0;
      border-bottom: 4px solid var(--breick-yellow);
      margin-bottom: 0.5rem;
      background: linear-gradient(180deg, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
    }

    h1 {
      font-size: clamp(0.6rem, 2.5vw, 1rem);
      color: var(--breick-yellow);
      text-shadow: 3px 3px 0px var(--breick-purple-dark);
    }

    .setup-panel {
      background: linear-gradient(180deg, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
      border: 4px solid var(--breick-yellow);
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 0 20px rgba(107, 45, 123, 0.5);
    }

    .setup-title {
      text-align: center;
      color: var(--breick-yellow);
      font-size: 0.7rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 0px var(--breick-purple-dark);
    }

    .mode-selector {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .mode-btn {
      padding: 0.8rem;
      border: 4px solid var(--breick-purple-light);
      background: var(--breick-purple-dark);
      color: #fff;
      cursor: pointer;
      transition: all 0.1s;
      text-align: left;
    }

    .mode-btn:hover {
      border-color: var(--breick-yellow);
      transform: translate(-2px, -2px);
      box-shadow: 4px 4px 0px var(--breick-yellow);
    }

    .mode-btn.active {
      border-color: var(--breick-yellow);
      background: var(--breick-purple-light);
      box-shadow: 4px 4px 0px var(--breick-yellow-dark);
    }

    .mode-btn h3 {
      color: var(--breick-yellow);
      font-size: 0.6rem;
      margin-bottom: 0.3rem;
    }

    .mode-btn p {
      font-size: 0.45rem;
      opacity: 0.8;
      line-height: 1.4;
    }

    .setup-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .setup-group {
      flex: 1;
      min-width: 150px;
    }

    .setup-group label {
      display: block;
      margin-bottom: 0.3rem;
      font-size: 0.5rem;
      color: var(--breick-yellow);
    }

    .setup-group input {
      width: 100%;
      padding: 0.5rem;
      border: 4px solid var(--breick-purple-light);
      background: var(--breick-purple-dark);
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.5rem;
    }

    .setup-group input:focus {
      outline: none;
      border-color: var(--breick-yellow);
    }

    .prizes-preview {
      background: var(--breick-purple-dark);
      border: 4px solid var(--breick-purple-light);
      padding: 0.8rem;
      margin-bottom: 1rem;
    }

    .prizes-preview h4 {
      color: var(--breick-yellow);
      font-size: 0.5rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .prize-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    .prize-item {
      padding: 0.4rem 0.6rem;
      border: 2px solid;
      font-size: 0.4rem;
      text-align: center;
    }

    .prize-item.aiqar { border-color: #00BFFF; color: #00BFFF; }
    .prize-item.byd { border-color: #FF4500; color: #FF4500; }
    .prize-item.vale { border-color: #00FF00; color: #00FF00; }

    .players-preview {
      background: var(--breick-purple-dark);
      border: 4px solid var(--breick-purple-light);
      padding: 0.8rem;
      margin-bottom: 1rem;
    }

    .players-preview h4 {
      color: var(--breick-yellow);
      font-size: 0.5rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .color-list {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }

    .color-item {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
      border: 4px solid #000;
    }

    .btn-start {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(180deg, var(--breick-yellow) 0%, var(--breick-yellow-dark) 100%);
      border: 4px solid var(--breick-purple);
      color: var(--breick-purple-dark);
      font-family: 'Press Start 2P', cursive;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.1s;
    }

    .btn-start:hover {
      transform: translate(-2px, -2px);
      box-shadow: 4px 4px 0px var(--breick-purple);
      background: linear-gradient(180deg, var(--breick-yellow-light) 0%, var(--breick-yellow) 100%);
    }

    .btn-start:active {
      transform: translate(0, 0);
      box-shadow: none;
    }

    .game-area {
      display: none;
    }

    .game-area.active {
      display: flex;
      flex: 1;
      height: 100%;
      overflow: hidden;
    }

    .game-layout {
      display: flex;
      width: 100%;
      height: 100%;
    }

    .game-sidebar {
      width: 140px;
      min-width: 140px;
      background: linear-gradient(180deg, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
      border-right: 3px solid var(--breick-yellow);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.4rem;
      border-bottom: 2px solid var(--breick-yellow);
      gap: 0.3rem;
    }

    .sidebar-buttons {
      display: flex;
      gap: 0.2rem;
    }

    .sidebar-buttons .btn-reveal,
    .sidebar-buttons .btn-restart {
      padding: 0.3rem 0.4rem;
      font-size: 0.5rem;
    }

    .players-list {
      display: flex;
      flex-direction: column;
      gap: 0;
      flex: 1;
    }

    .players-list .player-card {
      flex-direction: row;
      justify-content: flex-start;
      padding: 0.4rem;
      border-left: none;
      border-bottom: 1px solid var(--breick-purple-light);
      min-width: auto;
    }

    .board-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
      background: radial-gradient(ellipse at center, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
      position: relative;
    }

    .coords-top {
      display: flex;
      justify-content: center;
      margin-bottom: 2px;
    }

    .coords-top .coord-cell {
      width: calc((min(calc(100vw - 180px), calc(100vh - 60px)) - 20px) / 10);
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--breick-yellow);
      font-weight: bold;
    }

    .coords-top .coord-cell:first-child {
      width: 20px;
    }

    .board-with-rows {
      display: flex;
    }

    .coords-left {
      display: flex;
      flex-direction: column;
      margin-right: 2px;
    }

    .coords-left .coord-cell {
      width: 20px;
      height: calc((min(calc(100vw - 180px), calc(100vh - 60px)) - 20px) / 10);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--breick-yellow);
      font-weight: bold;
    }

    .game-header {
      display: none;
    }

    .turn-label {
      font-size: 0.35rem;
      opacity: 0.8;
    }

    .current-player-badge {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.4rem;
      background: rgba(255,184,28,0.2);
      border: 2px solid var(--breick-yellow);
      border-radius: 4px;
    }

    .current-player-num {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
      color: #000;
      border-radius: 6px;
      animation: pulseBadge 1s ease-in-out infinite;
      box-shadow: 0 0 10px rgba(255,184,28,0.5);
    }

    @keyframes pulseBadge {
      0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(255,184,28,0.5); }
      50% { transform: scale(1.1); box-shadow: 0 0 20px rgba(255,184,28,0.8); }
    }

    .turn-arrow {
      font-size: 1rem;
      animation: bounce-arrow 0.8s ease-in-out infinite;
      color: var(--breick-yellow);
    }

    @keyframes bounce-arrow {
      0%, 100% { transform: translateX(0) scale(1); }
      50% { transform: translateX(5px) scale(1.2); }
    }

    .btn-reveal {
      padding: 0.5rem 0.8rem;
      background: rgba(255,200,50,0.3);
      border: none;
      border-left: 2px solid var(--breick-yellow);
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.6rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-reveal:hover {
      background: rgba(255,200,50,0.5);
    }

    .btn-restart {
      padding: 0.5rem 0.8rem;
      background: rgba(255,50,50,0.3);
      border: none;
      border-left: 2px solid var(--breick-yellow);
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.6rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-restart:hover {
      background: rgba(255,50,50,0.5);
    }

    .progress-panel {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.5rem;
      border-left: 2px solid var(--breick-yellow);
      background: rgba(0,0,0,0.2);
    }

    .progress-item {
      display: flex;
      align-items: center;
      gap: 3px;
      padding: 3px 6px;
      border-radius: 4px;
      font-size: 0.35rem;
      font-weight: bold;
    }

    .progress-item.aiqar-prog {
      background: linear-gradient(135deg, #00BFFF 0%, #0080CC 100%);
      color: #fff;
      border: 1px solid #00BFFF;
    }

    .progress-item.byd-prog {
      background: linear-gradient(135deg, #FF4500 0%, #CC2200 100%);
      color: #fff;
      border: 1px solid #FF4500;
    }

    .progress-item.winner {
      animation: winnerPulse 0.5s ease-in-out infinite;
    }

    .progress-item.warning {
      animation: warningPulse 0.8s ease-in-out infinite;
    }

    @keyframes winnerPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    @keyframes warningPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .players-panel {
      display: flex;
      flex: 1;
      gap: 0;
    }

    .player-card {
      flex: 1;
      padding: 0.15rem;
      background: rgba(0,0,0,0.2);
      border: none;
      border-left: 2px solid var(--breick-purple-light);
      text-align: center;
      transition: all 0.1s;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 0.2rem;
      min-width: 45px;
    }

    .player-card:first-child {
      border-left: 2px solid var(--breick-yellow);
    }

    .player-card.active {
      /* Color aplicado din√°micamente en JS */
    }

    .player-card.winner-aiqar {
      background: rgba(0, 191, 255, 0.35);
    }

    .player-card.winner-byd {
      background: rgba(255, 69, 0, 0.35);
    }

    .player-card.winner-vale {
      background: rgba(0, 255, 0, 0.35);
    }

    .player-number {
      font-size: 0.6rem;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-weight: bold;
      border-radius: 4px;
      border: 2px solid rgba(0,0,0,0.3);
    }

    .player-stats {
      display: flex;
      flex-direction: row;
      gap: 3px;
      align-items: center;
      overflow: hidden;
    }

    .player-stats img {
      width: 22px !important;
      height: 14px !important;
      max-width: 22px !important;
      max-height: 14px !important;
    }

    .stat-row {
      display: flex;
      align-items: center;
      gap: 1px;
      font-size: 0.32rem;
      font-weight: bold;
      line-height: 1;
    }

    .stat-row .stat-logo {
      width: 14px !important;
      height: 10px !important;
      max-width: 14px !important;
      max-height: 10px !important;
      min-width: 14px;
      min-height: 10px;
      object-fit: contain;
      flex-shrink: 0;
      display: block;
    }

    .stat-row .stat-num {
      min-width: 8px;
      text-align: center;
    }

    .stat-row.aiqar-row {
      color: #00BFFF;
      text-shadow: 1px 1px 0 #000;
    }

    .stat-row.byd-row {
      color: #FF4500;
      text-shadow: 1px 1px 0 #000;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 3px;
      padding: 3px 5px;
      border-radius: 4px;
      font-size: 0.35rem;
      font-weight: bold;
    }

    .stat-item.aiqar {
      background: linear-gradient(135deg, #00BFFF 0%, #0080CC 100%);
      color: #fff;
      border: 1px solid #00BFFF;
    }

    .stat-item.byd {
      background: linear-gradient(135deg, #FF4500 0%, #CC2200 100%);
      color: #fff;
      border: 1px solid #FF4500;
    }

    .stat-item.breick {
      background: linear-gradient(135deg, var(--breick-yellow) 0%, var(--breick-yellow-dark) 100%);
      color: var(--breick-purple-dark);
      border: 1px solid var(--breick-yellow);
    }

    .stat-icon {
      font-size: 0.5rem;
      line-height: 1;
    }

    .player-prize {
      font-size: 0.25rem;
      color: var(--breick-yellow);
      background: rgba(0,0,0,0.3);
      padding: 1px 4px;
      border-radius: 2px;
    }

    .alert-box {
      display: none;
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.5rem 1rem;
      border: 3px solid var(--breick-yellow);
      text-align: center;
      font-size: 0.45rem;
      background: var(--breick-purple-dark);
      z-index: 500;
      border-radius: 6px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      max-width: 90%;
    }

    .alert-box.active {
      display: block;
    }

    .alert-box.warning {
      border-color: var(--breick-yellow);
      color: var(--breick-yellow);
    }

    @keyframes pulse-alert {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.02); }
    }

    .board {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      grid-template-rows: repeat(10, 1fr);
      gap: 3px;
      background: var(--breick-purple-dark);
      padding: 6px;
      border: 4px solid var(--breick-yellow);
      box-shadow: 0 0 30px rgba(255, 184, 28, 0.4);
      width: min(calc(100vw - 180px), calc(100vh - 60px));
      height: min(calc(100vw - 180px), calc(100vh - 60px));
      max-width: calc(100vh - 60px);
      max-height: calc(100vh - 60px);
    }

    .cell {
      background: linear-gradient(145deg, var(--breick-purple-light) 0%, var(--breick-purple) 50%, var(--breick-purple-dark) 100%);
      border: 2px solid var(--breick-yellow);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease, transform 0.15s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3), inset 0 1px 2px rgba(255,255,255,0.1);
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
    }

    .cell:hover:not(.revealed):not(.clicking) {
      background: linear-gradient(145deg, var(--breick-yellow-light) 0%, var(--breick-yellow) 50%, var(--breick-yellow-dark) 100%);
      border-color: var(--breick-yellow);
      transform: scale(1.08) rotateX(5deg);
      z-index: 10;
      box-shadow: 0 0 20px rgba(255, 184, 28, 0.8), 0 8px 16px rgba(0,0,0,0.4);
    }

    .cell.clicking {
      animation: cellClick 0.3s ease-out;
      z-index: 20;
    }

    @keyframes cellClick {
      0% { transform: scale(1); }
      30% { transform: scale(0.85); box-shadow: 0 0 30px rgba(255, 255, 255, 0.9); }
      60% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .cell.revealed {
      cursor: default;
      border-color: var(--breick-purple-dark);
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.4);
    }

    .cell.just-revealed {
      animation: flipIn 0.4s ease-out, glowPulse 0.6s ease-out;
    }

    @keyframes flipIn {
      0% { transform: rotateY(90deg) scale(0.8); opacity: 0.5; }
      100% { transform: rotateY(0deg) scale(1); opacity: 1; }
    }

    @keyframes glowPulse {
      0%, 100% { box-shadow: inset 0 2px 6px rgba(0,0,0,0.4); }
      50% { box-shadow: 0 0 25px rgba(255, 184, 28, 1), inset 0 2px 6px rgba(0,0,0,0.4); }
    }

    .cell.aiqar {
      background: linear-gradient(145deg, #0090c0 0%, #007099 50%, #005070 100%);
      border-color: #00BFFF;
    }

    .cell.byd {
      background: linear-gradient(145deg, #c03500 0%, #a02500 50%, #801500 100%);
      border-color: #FF4500;
    }

    .cell.brick {
      background: linear-gradient(145deg, #f5f5f5 0%, #e0e0e0 50%, #d0d0d0 100%);
      border-color: #aaa;
    }

    .cell.key-aiqar {
      background: linear-gradient(145deg, #00a070 0%, #008050 50%, #006040 100%);
      border-color: #00FF80;
    }

    .cell.key-byd {
      background: linear-gradient(145deg, #a000a0 0%, #800080 50%, #600060 100%);
      border-color: #FF00FF;
    }

    .cell.special {
      background: linear-gradient(145deg, var(--breick-yellow-light) 0%, var(--breick-yellow) 50%, var(--breick-yellow-dark) 100%);
      border-color: var(--breick-purple);
    }

    .cell:not(.revealed) {
      cursor: pointer;
    }

    /* Iconos de celda */
    .tire-icon {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('/tire.png');
      background-position: center;
      background-repeat: no-repeat;
      background-size: 75%;
    }

    .breick-icon {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('/breick-logo.png');
      background-position: center;
      background-repeat: no-repeat;
      background-size: 70%;
    }

    .brand-badge {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70%;
      height: 50%;
      min-width: 25px;
      min-height: 15px;
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      pointer-events: none;
    }

    .aiqar-badge {
      background-image: url('/aiqar-logo.svg');
    }

    .byd-badge {
      background-image: url('/byd-logo.png');
    }

    .key-icon {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0;
    }

    .key-icon .key-emoji {
      font-size: clamp(14px, 5vw, 28px);
      line-height: 1;
      filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));
    }

    .key-icon .key-logo {
      width: 55%;
      height: 35%;
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      margin-top: 2px;
    }

    .key-icon .key-logo.aiqar-key {
      background-image: url('/aiqar-logo.svg');
    }

    .key-icon .key-logo.byd-key {
      background-image: url('/byd-logo.png');
    }


    .legend {
      display: none;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(180deg, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
      padding: 1.5rem;
      border: 8px solid var(--breick-yellow);
      text-align: center;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(255, 184, 28, 0.4);
    }

    .modal h2 {
      font-size: 0.8rem;
      color: var(--breick-yellow);
      margin-bottom: 1rem;
      text-shadow: 3px 3px 0px var(--breick-purple-dark);
    }

    .final-results {
      margin: 1rem 0;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      margin-bottom: 0.3rem;
      border: 4px solid;
      font-size: 0.4rem;
    }

    .result-item.pos-1 { border-color: #00BFFF; background: rgba(0, 191, 255, 0.2); }
    .result-item.pos-2 { border-color: #FF4500; background: rgba(255, 69, 0, 0.2); }
    .result-item.pos-3 { border-color: #00FF00; background: rgba(0, 255, 0, 0.2); }
    .result-item.pos-4 { border-color: #00CC00; background: rgba(0, 204, 0, 0.2); }
    .result-item.pos-5 { border-color: #009900; background: rgba(0, 153, 0, 0.2); }

    .result-position {
      font-size: 0.6rem;
    }

    .result-prize {
      font-size: 0.5rem;
      color: var(--breick-yellow);
    }

    .result-color {
      display: inline-block;
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
      color: #000;
      font-weight: bold;
      margin-right: 0.5rem;
    }

    .special-modal {
      max-width: 400px;
    }

    .special-modal h3 {
      color: var(--breick-yellow);
      font-size: 0.6rem;
      margin-bottom: 0.5rem;
    }

    .special-modal p {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .special-icon {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }

    .choice-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      align-items: stretch;
      width: 100%;
    }

    .choice-btn {
      padding: 2rem 2.5rem;
      border: 6px solid var(--breick-purple-light);
      background: var(--breick-purple-dark);
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      font-size: 1.8rem;
      cursor: pointer;
      width: 100%;
      min-height: 120px;
    }

    .choice-btn img {
      width: 60px !important;
      height: 40px !important;
      vertical-align: middle;
      margin-right: 10px;
    }

    .choice-btn:hover {
      border-color: var(--breick-yellow);
      background: var(--breick-purple);
    }

    .choice-btn.aiqar { border-color: #00BFFF; }
    .choice-btn.byd { border-color: #FF4500; }

    .skip-turn {
      background: #333;
      border-color: #666;
      color: #999;
    }

    @media (max-width: 768px) {
      .game-top-bar {
        flex-wrap: nowrap;
      }

      .game-header {
        padding: 0.2rem 0.4rem;
      }

      .players-panel {
        flex: 1;
        overflow-x: auto;
      }

      .player-card {
        padding: 0.1rem;
        min-width: 40px;
        gap: 0.15rem;
      }

      .player-number {
        width: 18px;
        height: 18px;
        font-size: 0.5rem;
      }

      .stat-row {
        font-size: 0.3rem;
        gap: 1px;
      }

      .player-stats img {
        width: 18px !important;
        height: 12px !important;
      }

      .current-player-num {
        width: 18px;
        height: 18px;
        font-size: 0.5rem;
      }

      .turn-arrow {
        font-size: 0.5rem;
      }

      .board {
        gap: 3px;
        padding: 3px;
      }

      .cell {
        border-width: 2px;
        border-radius: 4px;
      }
    }

    @media (max-width: 600px) {
      .game-layout {
        flex-direction: column;
      }

      .game-sidebar {
        width: 100%;
        min-width: auto;
        flex-direction: row;
        border-right: none;
        border-bottom: 3px solid var(--breick-yellow);
        max-height: 60px;
        overflow-x: auto;
      }

      .players-list {
        flex-direction: row;
        overflow-x: auto;
      }

      .players-list .player-card {
        border-bottom: none;
        border-right: 1px solid var(--breick-purple-light);
        min-width: 60px;
      }

      .board-area {
        padding: 0.3rem;
      }

      .board {
        width: min(calc(100vw - 30px), calc(100vh - 140px));
        height: min(calc(100vw - 30px), calc(100vh - 140px));
      }

      .coords-top .coord-cell {
        width: calc((min(calc(100vw - 30px), calc(100vh - 140px)) - 20px) / 10);
        font-size: 1.5rem;
      }

      .coords-left .coord-cell {
        height: calc((min(calc(100vw - 30px), calc(100vh - 140px)) - 20px) / 10);
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Panel de Configuracion -->
    <div class="setup-panel" id="setup">
      <div class="setup-title">CONFIGURACION</div>

      <div class="mode-selector">
        <div class="mode-btn active" data-mode="coleccion">
          <h3>MODO 1: COLECCION</h3>
          <p>4 llantas + llave = auto. El ULTIMO en completar cada set gana ese auto.</p>
        </div>
        <div class="mode-btn" data-mode="carrera">
          <h3>MODO 2: CARRERA</h3>
          <p>PRIMERO en juntar 4 llantas de un auto lo gana. Sin llaves.</p>
        </div>
        <div class="mode-btn" data-mode="caos">
          <h3>MODO 3: CAOS</h3>
          <p>Como Carrera + casillas especiales. Todos ganan algo!</p>
        </div>
      </div>

      <div class="prizes-preview">
        <h4>üèÜ TODOS GANAN üèÜ</h4>
        <div class="prize-list">
          <div class="prize-item aiqar">üöó AIQAR</div>
          <div class="prize-item byd">üöó BYD</div>
          <div class="prize-item vale">üí∞ 10,000 Bs</div>
          <div class="prize-item vale">üí∞ 8,000 Bs</div>
          <div class="prize-item vale">üí∞ 6,000 Bs</div>
        </div>
      </div>

      <div class="players-preview">
        <h4>JUGADORES</h4>
        <div class="color-list">
          <div class="color-item" style="background: #FF6B6B;">1</div>
          <div class="color-item" style="background: #4ECDC4;">2</div>
          <div class="color-item" style="background: #FFE66D; color: #000;">3</div>
          <div class="color-item" style="background: #95E1D3;">4</div>
          <div class="color-item" style="background: #DDA0DD;">5</div>
        </div>
      </div>

      <button class="btn-start" id="startGame">‚ñ∂ INICIAR JUEGO</button>
    </div>

    <!-- Area de Juego -->
    <div class="game-area" id="gameArea">
      <div class="game-layout">
        <!-- Sidebar izquierdo con jugadores -->
        <div class="game-sidebar">
          <div class="sidebar-header">
            <span class="turn-arrow">‚ñ∂</span>
            <div class="current-player-badge">
              <div class="current-player-num" id="currentPlayerBadge">1</div>
            </div>
            <div class="sidebar-buttons">
              <button class="btn-reveal" onclick="confirmRevealAll()">üëÅ</button>
              <button class="btn-restart" onclick="resetGame()">‚úï</button>
            </div>
          </div>
          <div class="progress-panel" id="progressPanel"></div>
          <div class="players-list" id="playersPanel"></div>
        </div>

        <!-- Tablero con coordenadas -->
        <div class="board-area">
          <div class="alert-box" id="alertBox"></div>

          <!-- Coordenadas columnas (A-J) -->
          <div class="coords-top">
            <div class="coord-cell"></div>
            <div class="coord-cell">A</div>
            <div class="coord-cell">B</div>
            <div class="coord-cell">C</div>
            <div class="coord-cell">D</div>
            <div class="coord-cell">E</div>
            <div class="coord-cell">F</div>
            <div class="coord-cell">G</div>
            <div class="coord-cell">H</div>
            <div class="coord-cell">I</div>
            <div class="coord-cell">J</div>
          </div>

          <div class="board-with-rows">
            <!-- Coordenadas filas (1-10) -->
            <div class="coords-left">
              <div class="coord-cell">1</div>
              <div class="coord-cell">2</div>
              <div class="coord-cell">3</div>
              <div class="coord-cell">4</div>
              <div class="coord-cell">5</div>
              <div class="coord-cell">6</div>
              <div class="coord-cell">7</div>
              <div class="coord-cell">8</div>
              <div class="coord-cell">9</div>
              <div class="coord-cell">10</div>
            </div>

            <div class="board" id="board"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Final -->
  <div class="modal" id="finalModal">
    <div class="modal-content">
      <h2>üèÜ RESULTADOS FINALES üèÜ</h2>
      <div class="final-results" id="finalResults"></div>
      <button class="btn-start" onclick="resetGame()">JUGAR DE NUEVO</button>
    </div>
  </div>

  <!-- Modal Especial -->
  <div class="modal" id="specialModal">
    <div class="modal-content special-modal">
      <div class="special-icon" id="specialIcon"></div>
      <h3 id="specialTitle"></h3>
      <p id="specialDesc"></p>
      <div class="choice-buttons" id="specialButtons"></div>
    </div>
  </div>

  <!-- Modal Alerta -->
  <div class="modal" id="alertModal">
    <div class="modal-content special-modal">
      <div class="special-icon" id="alertIcon"></div>
      <h3 id="alertTitle"></h3>
      <p id="alertDesc"></p>
      <button class="btn-start" id="alertOk">OK</button>
    </div>
  </div>

  <!-- Modal Confirmar Revelar -->
  <div class="modal" id="confirmRevealModal">
    <div class="modal-content special-modal">
      <div class="special-icon">üëÅ</div>
      <h3>REVELAR TODO</h3>
      <p>Esto mostrara todas las casillas del tablero. El juego continuara normalmente.</p>
      <div class="choice-buttons">
        <button class="choice-btn" onclick="revealAllBoard()">SI, REVELAR</button>
        <button class="choice-btn skip-turn" onclick="closeConfirmReveal()">CANCELAR</button>
      </div>
    </div>
  </div>

  <script>
    // Colores de jugadores
    const PLAYER_COLORS = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#DDA0DD'];

    // Tipos especiales
    const SPECIAL_TYPES = [
      { id: 'doble', icon: 'üîÑ', name: 'DOBLE TURNO', desc: 'Juegas otra vez!' },
      { id: 'robar', icon: 'üè¥‚Äç‚ò†Ô∏è', name: 'ROBAR', desc: 'Robas 1 llanta a un jugador al azar' },
      { id: 'revelar2', icon: 'üëÄ', name: 'REVELAR 2', desc: 'Puedes abrir otra casilla' },
      { id: 'bomba', icon: 'üí£', name: 'BOMBA', desc: 'Pierdes todas tus llantas de un tipo al azar' },
      { id: 'comodin', icon: 'üÉè', name: 'COMODIN', desc: 'Cuenta como llanta del tipo que elijas' },
      { id: 'intercambio', icon: 'üîÄ', name: 'INTERCAMBIO', desc: 'Intercambias llantas con jugador al azar' },
      { id: 'espejo', icon: 'ü™û', name: 'ESPEJO', desc: 'Copias las llantas de un jugador al azar' },
      { id: 'bloqueo', icon: 'üö´', name: 'BLOQUEO', desc: 'El siguiente jugador pierde su turno' }
    ];

    // Estado del juego
    let gameState = {
      mode: 'coleccion',
      players: [],
      currentPlayer: 0,
      board: [],
      revealed: [],
      cellOwners: [],
      gameOver: false,
      aiqarWinner: null,
      bydWinner: null,
      // Modo 1: piezas totales encontradas (no importa qui√©n)
      aiqarPiecesFound: 0, // 4 llantas + 1 llave = 5 total
      bydPiecesFound: 0,
      skipNextPlayer: false,
      extraTurn: false,
      revealExtra: false
    };

    // Configuracion
    const CONFIG = {
      boardSize: 10,
      aiqarTires: 14,  // Modo 2/3
      bydTires: 12,    // Modo 2/3
      specialCells: 12
    };

    // Inicializacion
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          gameState.mode = btn.dataset.mode;
          updateLegend();
        });
      });

      document.getElementById('startGame').addEventListener('click', startGame);
      document.getElementById('alertOk').addEventListener('click', closeAlertAndContinue);
    });

    function updateLegend() {
      document.querySelectorAll('.legend-key').forEach(el => {
        // Llaves solo en modo 1 (coleccion)
        el.style.display = gameState.mode === 'coleccion' ? 'flex' : 'none';
      });
      document.querySelectorAll('.legend-special').forEach(el => {
        el.style.display = gameState.mode === 'caos' ? 'flex' : 'none';
      });
    }

    function startGame() {
      gameState.players = PLAYER_COLORS.map((color, i) => ({
        number: i + 1,
        aiqar: 0,
        byd: 0,
        keyAiqar: false,
        keyByd: false,
        bricks: 0,
        prize: null,
        protected: false,
        color: color
      }));

      gameState.currentPlayer = 0;
      gameState.gameOver = false;
      gameState.aiqarWinner = null;
      gameState.bydWinner = null;
      gameState.aiqarPiecesFound = 0;
      gameState.bydPiecesFound = 0;
      gameState.skipNextPlayer = false;
      gameState.extraTurn = false;
      gameState.revealExtra = false;

      generateBoard();

      document.getElementById('setup').style.display = 'none';
      document.getElementById('gameArea').classList.add('active');
      document.querySelector('.container').classList.add('fullscreen');

      updateLegend();
      renderBoard();
      renderPlayers();
      updateCurrentPlayer();
      updateProgressPanel();
      saveGameState();
    }

    function generateBoard() {
      const totalCells = CONFIG.boardSize * CONFIG.boardSize;

      if (gameState.mode === 'coleccion') {
        gameState.board = generateRiggedBoardMode1(totalCells);
      } else if (gameState.mode === 'carrera') {
        gameState.board = generateRiggedBoardMode2(totalCells);
      } else {
        gameState.board = generateRiggedBoardMode3(totalCells);
      }

      gameState.revealed = new Array(totalCells).fill(false);
      gameState.cellOwners = new Array(totalCells).fill(null);
    }

    // MODO 1: Colecci√≥n - drama m√°ximo con piezas ganadoras juntas
    function generateRiggedBoardMode1(totalCells) {
      const board = new Array(totalCells).fill('brick');
      const size = CONFIG.boardSize;

      // === ESTRATEGIA: ZONA DE DRAMA ===
      // Las piezas ganadoras (5ta de cada auto) est√°n MUY CERCA entre s√≠
      // Esto crea tensi√≥n: encontrar un √°rea puede dar ambos autos

      // 1. SE√ëUELOS: Clusters de 2-3 piezas tempranas para atraer
      //    Van en esquinas/bordes para que busquen ah√≠ primero
      const baitZones = [
        [0, 1, 10, 11],           // Esquina sup-izq
        [8, 9, 18, 19],           // Esquina sup-der
        [80, 81, 90, 91],         // Esquina inf-izq
        [88, 89, 98, 99]          // Esquina inf-der
      ];

      // Colocar se√±uelos AIQAR (2 llantas en 2 esquinas)
      shuffleArray(baitZones);
      const aiqarBait1 = shuffleArray([...baitZones[0]]);
      const aiqarBait2 = shuffleArray([...baitZones[1]]);
      board[aiqarBait1[0]] = 'aiqar';
      board[aiqarBait1[1]] = 'aiqar';
      board[aiqarBait2[0]] = 'aiqar';

      // Colocar se√±uelos BYD (2 llantas en otras esquinas)
      const bydBait1 = shuffleArray([...baitZones[2]]);
      const bydBait2 = shuffleArray([...baitZones[3]]);
      board[bydBait1[0]] = 'byd';
      board[bydBait1[1]] = 'byd';
      board[bydBait2[0]] = 'byd';

      // 2. ZONA DE DRAMA CENTRAL: Las piezas ganadoras
      //    La 4ta llanta y llave de AMBOS autos est√°n en un √°rea peque√±a del centro
      const centerArea = [44, 45, 54, 55, 34, 35, 43, 46, 53, 56, 64, 65];
      shuffleArray(centerArea);

      // Piezas ganadoras JUNTAS (m√°ximo drama)
      board[centerArea[0]] = 'aiqar';      // 4ta llanta AIQAR
      board[centerArea[1]] = 'key-aiqar';  // Llave AIQAR
      board[centerArea[2]] = 'byd';        // 4ta llanta BYD
      board[centerArea[3]] = 'key-byd';    // Llave BYD

      // 3. LLAVES SEPARADAS: Una llave extra en zona opuesta (m√°s dif√≠cil)
      //    No aplica - modo 1 solo tiene 4 llantas + 1 llave por auto

      // 4. Peque√±a mezcla para que no sea obvio
      for (let i = 0; i < 8; i++) {
        const a = Math.floor(Math.random() * totalCells);
        const b = Math.floor(Math.random() * totalCells);
        // Solo intercambiar bricks con bricks o items del mismo tipo
        if (board[a] === 'brick' && board[b] === 'brick') {
          // No hacer nada, ya son iguales
        } else if (board[a] === 'brick' || board[b] === 'brick') {
          // Intercambiar solo si no rompe los clusters importantes
          const isImportant = centerArea.slice(0, 4).includes(a) || centerArea.slice(0, 4).includes(b);
          if (!isImportant && Math.random() < 0.3) {
            [board[a], board[b]] = [board[b], board[a]];
          }
        }
      }

      return board;
    }

    // MODO 2: Carrera - clusters intercalados + zona final disputada
    function generateRiggedBoardMode2(totalCells) {
      const board = new Array(totalCells).fill('brick');
      const size = CONFIG.boardSize;

      // === ESTRATEGIA: RACHAS + ZONA FINAL DISPUTADA ===
      // 1. Clusters de 2-3 llantas para crear "rachas" emocionantes
      // 2. La 4ta llanta de AMBOS tipos est√° en la MISMA zona = carrera final

      // Definir zonas del tablero
      const zones = {
        topLeft: [0,1,2,10,11,12,20,21,22],
        topRight: [7,8,9,17,18,19,27,28,29],
        bottomLeft: [70,71,72,80,81,82,90,91,92],
        bottomRight: [77,78,79,87,88,89,97,98,99],
        center: [33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66]
      };

      // 1. CLUSTERS INTERCALADOS: AIQAR y BYD comparten zonas
      //    Total: 14 AIQAR + 12 BYD

      // Cluster 1 (top-left): 3 AIQAR + 3 BYD
      let zone = shuffleArray([...zones.topLeft]);
      board[zone[0]] = 'aiqar';
      board[zone[1]] = 'aiqar';
      board[zone[2]] = 'aiqar';
      board[zone[3]] = 'byd';
      board[zone[4]] = 'byd';
      board[zone[5]] = 'byd';

      // Cluster 2 (top-right): 3 AIQAR + 3 BYD
      zone = shuffleArray([...zones.topRight]);
      board[zone[0]] = 'aiqar';
      board[zone[1]] = 'aiqar';
      board[zone[2]] = 'aiqar';
      board[zone[3]] = 'byd';
      board[zone[4]] = 'byd';
      board[zone[5]] = 'byd';

      // Cluster 3 (bottom-left): 2 AIQAR + 2 BYD
      zone = shuffleArray([...zones.bottomLeft]);
      board[zone[0]] = 'aiqar';
      board[zone[1]] = 'aiqar';
      board[zone[2]] = 'byd';
      board[zone[3]] = 'byd';

      // Cluster 4 (bottom-right): 2 AIQAR + 2 BYD
      zone = shuffleArray([...zones.bottomRight]);
      board[zone[0]] = 'aiqar';
      board[zone[1]] = 'aiqar';
      board[zone[2]] = 'byd';
      board[zone[3]] = 'byd';

      // 2. ZONA FINAL DISPUTADA: Las llantas ganadoras en el CENTRO
      zone = shuffleArray([...zones.center]);
      // AIQAR: ya hay 10, faltan 4 para llegar a 14
      board[zone[0]] = 'aiqar';
      board[zone[1]] = 'aiqar';
      board[zone[2]] = 'aiqar';
      board[zone[3]] = 'aiqar';

      // BYD: ya hay 10, faltan 2 para llegar a 12
      board[zone[4]] = 'byd';
      board[zone[5]] = 'byd';

      // 3. DISPERSAR algunas para que no sea tan predecible
      const emptyPositions = board.map((item, i) => item === 'brick' ? i : -1).filter(i => i >= 0);
      shuffleArray(emptyPositions);

      // Mover 2-3 llantas random a posiciones dispersas
      const aiqarPositions = board.map((item, i) => item === 'aiqar' ? i : -1).filter(i => i >= 0);
      const bydPositions = board.map((item, i) => item === 'byd' ? i : -1).filter(i => i >= 0);

      // Intercambiar algunas posiciones para variedad
      for (let i = 0; i < 3 && emptyPositions.length > 0; i++) {
        // Mover una AIQAR aleatoria
        if (aiqarPositions.length > 4) {
          const fromIdx = Math.floor(Math.random() * aiqarPositions.length);
          const from = aiqarPositions[fromIdx];
          const to = emptyPositions.pop();
          board[from] = 'brick';
          board[to] = 'aiqar';
        }
      }

      return board;
    }

    // MODO 3: Caos total - especiales estrat√©gicos
    // Todo se determina al inicio basado en POSICI√ìN, no en orden de clicks
    function generateRiggedBoardMode3(totalCells) {
      const board = generateRiggedBoardMode2(totalCells);

      // Identificar zonas del tablero
      const nearTirePositions = []; // Cerca de llantas = CAOS (drama al buscar ganar)
      const farFromTirePositions = []; // Lejos de llantas = REMONTADA (ayuda a quien no encuentra)

      for (let i = 0; i < totalCells; i++) {
        if (board[i] === 'brick') {
          const neighbors = getNeighbors(i);
          const neighbors2 = neighbors.flatMap(n => getNeighbors(n)); // Vecinos de vecinos
          const hasTireNear = neighbors.some(n => board[n] === 'aiqar' || board[n] === 'byd');
          const hasTireFar = neighbors2.some(n => board[n] === 'aiqar' || board[n] === 'byd');

          if (hasTireNear) {
            nearTirePositions.push(i);
          } else if (!hasTireFar) {
            farFromTirePositions.push(i);
          }
        }
      }

      shuffleArray(nearTirePositions);
      shuffleArray(farFromTirePositions);

      // CERCA DE LLANTAS: Caos y bloqueos (drama cuando buscan ganar)
      const chaosSpecials = ['bomba', 'bomba', 'bloqueo', 'bloqueo', 'intercambio'];
      for (let i = 0; i < chaosSpecials.length && nearTirePositions.length > 0; i++) {
        const pos = nearTirePositions.pop();
        board[pos] = 'special-' + chaosSpecials[i];
      }

      // LEJOS DE LLANTAS: Remontada y bonus (ayuda a quien explora sin suerte)
      const helpSpecials = ['robar', 'espejo', 'comodin', 'doble', 'revelar2', 'comodin', 'robar'];
      for (let i = 0; i < helpSpecials.length && farFromTirePositions.length > 0; i++) {
        const pos = farFromTirePositions.pop();
        board[pos] = 'special-' + helpSpecials[i];
      }

      return board;
    }

    function getNeighbors(index) {
      const size = CONFIG.boardSize;
      const row = Math.floor(index / size);
      const col = index % size;
      const neighbors = [];

      if (row > 0) neighbors.push(index - size);
      if (row < size - 1) neighbors.push(index + size);
      if (col > 0) neighbors.push(index - 1);
      if (col < size - 1) neighbors.push(index + 1);

      return neighbors;
    }

    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function renderBoard() {
      const board = document.getElementById('board');
      board.innerHTML = '';

      for (let i = 0; i < gameState.board.length; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = i;

        if (gameState.revealed[i]) {
          const itemType = gameState.board[i];
          const type = itemType.split('-')[0];
          cell.classList.add('revealed', type === 'special' ? 'special' : itemType);
          if (gameState.lastRevealed === i) {
            cell.classList.add('just-revealed');
          }

          // Aplicar background directamente a la celda
          applyCellBackground(cell, itemType);

          // Mostrar due√±o con borde del color del jugador
          if (gameState.cellOwners[i] !== null) {
            const playerColor = gameState.players[gameState.cellOwners[i]].color;
            cell.style.borderColor = playerColor;
            cell.style.boxShadow = `0 0 8px ${playerColor}, inset 0 0 4px rgba(0,0,0,0.3)`;
          }
        } else {
          cell.innerHTML = '<span style="font-size:clamp(16px, 5vw, 32px);color:#FFD700;text-shadow:0 0 10px #FFB81C, 2px 2px 0 #4A1F56;font-weight:bold;display:flex;align-items:center;justify-content:center;width:100%;height:100%;">?</span>';
          cell.addEventListener('click', (e) => {
            e.preventDefault();
            if (cell.classList.contains('clicking')) return;
            cell.classList.add('clicking');
            // Esperar animaci√≥n de click antes de revelar
            setTimeout(() => {
              revealCell(i);
            }, 200);
          });
        }

        board.appendChild(cell);
      }
    }

    function applyCellBackground(cell, type) {
      cell.style.backgroundPosition = 'center';
      cell.style.backgroundRepeat = 'no-repeat';

      if (type === 'aiqar' || type === 'byd') {
        // Llanta con logo del auto encima
        cell.style.background = `url(/tire.png) center/70% no-repeat`;
        // Logo peque√±o centrado usando img
        const logo = document.createElement('img');
        logo.src = type === 'aiqar' ? '/aiqar-logo.svg' : '/byd-logo.png';
        logo.style.cssText = 'width:100%;height:100%;object-fit:contain;pointer-events:none;';
        cell.appendChild(logo);
      } else if (type === 'brick') {
        const logo = document.createElement('img');
        logo.src = '/breick-logo.png';
        logo.style.cssText = 'width:100%;height:100%;object-fit:contain;pointer-events:none;';
        cell.appendChild(logo);
      } else if (type === 'key-aiqar' || type === 'key-byd') {
        // Llave con logo del auto
        const logoUrl = type === 'key-aiqar' ? '/aiqar-logo.svg' : '/byd-logo.png';
        cell.innerHTML = `
          <div style="width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;">
            <span style="font-size:clamp(16px,6vw,32px);line-height:1;filter:drop-shadow(1px 1px 2px rgba(0,0,0,0.5));">üîë</span>
            <img src="${logoUrl}" style="width:90%;height:auto;max-height:50%;object-fit:contain;">
          </div>
        `;
      } else if (type.startsWith('special-')) {
        const specialId = type.replace('special-', '');
        const special = SPECIAL_TYPES.find(s => s.id === specialId);
        cell.innerHTML = '<span style="font-size:clamp(12px, 4vw, 24px);display:flex;align-items:center;justify-content:center;width:100%;height:100%;">' + (special ? special.icon : '‚≠ê') + '</span>';
      }
    }

    function revealCell(index) {
      if (gameState.revealed[index] || gameState.gameOver) return;

      gameState.revealed[index] = true;
      gameState.cellOwners[index] = gameState.currentPlayer;
      gameState.lastRevealed = index;

      const item = gameState.board[index];
      const player = gameState.players[gameState.currentPlayer];

      // Procesar item
      if (item === 'aiqar') {
        player.aiqar++;
        if (gameState.mode === 'coleccion') {
          gameState.aiqarPiecesFound++;
          checkMode1Alert('aiqar');
        } else {
          // Modo 2/3: Alerta cuando tiene 3 llantas
          checkMode23Alert(player, 'aiqar');
        }
        checkAiqarWin(player, item);
      } else if (item === 'key-aiqar') {
        player.keyAiqar = true;
        if (gameState.mode === 'coleccion') {
          gameState.aiqarPiecesFound++;
          checkMode1Alert('aiqar');
        }
        checkAiqarWin(player, item);
      } else if (item === 'byd') {
        player.byd++;
        if (gameState.mode === 'coleccion') {
          gameState.bydPiecesFound++;
          checkMode1Alert('byd');
        } else {
          // Modo 2/3: Alerta cuando tiene 3 llantas
          checkMode23Alert(player, 'byd');
        }
        checkBydWin(player, item);
      } else if (item === 'key-byd') {
        player.keyByd = true;
        if (gameState.mode === 'coleccion') {
          gameState.bydPiecesFound++;
          checkMode1Alert('byd');
        }
        checkBydWin(player, item);
      } else if (item === 'brick') {
        player.bricks++;
      } else if (item.startsWith('special-')) {
        handleSpecial(item.replace('special-', ''), player);
        return; // Special handles next turn
      }

      renderBoard();
      renderPlayers();
      checkAlerts();
      saveGameState();

      // Limpiar last revealed despu√©s de la animaci√≥n
      setTimeout(() => { gameState.lastRevealed = null; }, 500);

      if (!gameState.gameOver) {
        if (gameState.revealExtra) {
          gameState.revealExtra = false;
          // No mostrar alerta - ya se mostr√≥ al encontrar el especial
        } else if (gameState.extraTurn) {
          gameState.extraTurn = false;
          // No mostrar alerta - ya se mostr√≥ al encontrar el especial
        } else {
          nextTurn();
        }
      }
    }

    function checkMode1Alert(carType) {
      updateProgressPanel();
      if (carType === 'aiqar' && gameState.aiqarPiecesFound === 4 && gameState.aiqarWinner === null) {
        showSmallAlert('‚ö†Ô∏è Proxima pieza AIQAR gana!');
      }
      if (carType === 'byd' && gameState.bydPiecesFound === 4 && gameState.bydWinner === null) {
        showSmallAlert('‚ö†Ô∏è Proxima pieza BYD gana!');
      }
    }

    function checkMode23Alert(player, carType) {
      updateProgressPanel();
      if (carType === 'aiqar' && player.aiqar === 3 && gameState.aiqarWinner === null) {
        showSmallAlert(`‚ö†Ô∏è J${player.number} a 1 llanta de AIQAR!`);
      }
      if (carType === 'byd' && player.byd === 3 && gameState.bydWinner === null) {
        showSmallAlert(`‚ö†Ô∏è J${player.number} a 1 llanta de BYD!`);
      }
    }

    function showSmallAlert(text) {
      const alertBox = document.getElementById('alertBox');
      alertBox.textContent = text;
      alertBox.className = 'alert-box active warning';
      // Auto-ocultar despu√©s de 2 segundos
      setTimeout(() => {
        alertBox.className = 'alert-box';
      }, 2000);
    }

    function checkAiqarWin(player, item) {
      if (gameState.aiqarWinner !== null) return; // Ya hay ganador

      if (gameState.mode === 'coleccion') {
        // Modo 1: Quien encuentra la ultima pieza (5ta) gana
        // Ya se increment√≥ aiqarPiecesFound en revealCell
        if (gameState.aiqarPiecesFound >= 5) {
          gameState.aiqarWinner = gameState.currentPlayer;
          player.prize = 'AIQAR';
          player.protected = true;
          showAlert('üöó', 'GANADOR AIQAR!', `Jugador ${player.number} encontro la ultima pieza y gano AIQAR!`);
          checkGameEnd();
        }
      } else {
        // Modo 2 y 3: Solo 4 llantas, PRIMERO gana
        if (player.aiqar >= 4) {
          gameState.aiqarWinner = gameState.currentPlayer;
          player.prize = 'AIQAR';
          player.protected = true;
          showAlert('üöó', 'GANADOR AIQAR!', `Jugador ${player.number} gano el AIQAR!`);
          checkGameEnd();
        }
      }
    }

    function checkBydWin(player, item) {
      if (gameState.bydWinner !== null) return; // Ya hay ganador

      if (gameState.mode === 'coleccion') {
        // Modo 1: Quien encuentra la ultima pieza (5ta) gana
        if (gameState.bydPiecesFound >= 5) {
          gameState.bydWinner = gameState.currentPlayer;
          player.prize = 'BYD';
          player.protected = true;
          showAlert('üöó', 'GANADOR BYD!', `Jugador ${player.number} encontro la ultima pieza y gano BYD!`);
          checkGameEnd();
        }
      } else {
        // Modo 2 y 3: Solo 4 llantas, PRIMERO gana
        if (player.byd >= 4) {
          gameState.bydWinner = gameState.currentPlayer;
          player.prize = 'BYD';
          player.protected = true;
          showAlert('üöó', 'GANADOR BYD!', `Jugador ${player.number} gano el BYD!`);
          checkGameEnd();
        }
      }
    }

    function checkGameEnd() {
      // Termina cuando ambos autos tienen ganador
      if (gameState.aiqarWinner !== null && gameState.bydWinner !== null) {
        gameState.gameOver = true;
        clearSavedGame();
        assignVales();
        showFinalResults();
      }
    }

    function assignVales() {
      // Obtener jugadores sin premio (los que no ganaron auto)
      const remaining = gameState.players
        .map((p, i) => ({ ...p, index: i }))
        .filter(p => !p.protected);

      // Ordenar por desempate: mas llantas de un tipo, total llantas, bricks
      remaining.sort((a, b) => {
        const aMax = Math.max(a.aiqar, a.byd);
        const bMax = Math.max(b.aiqar, b.byd);
        if (bMax !== aMax) return bMax - aMax;

        const aTotal = a.aiqar + a.byd;
        const bTotal = b.aiqar + b.byd;
        if (bTotal !== aTotal) return bTotal - aTotal;

        return b.bricks - a.bricks;
      });

      // Asignar vales - TODOS ganan algo
      const vales = ['10,000 Bs', '8,000 Bs', '6,000 Bs', '4,000 Bs', '2,000 Bs'];
      remaining.forEach((p, i) => {
        gameState.players[p.index].prize = vales[i] || '1,000 Bs';
      });

      gameState.gameOver = true;
    }

    function showFinalResults() {
      const results = document.getElementById('finalResults');
      results.innerHTML = '';

      // Ordenar por premio
      const prizeOrder = ['AIQAR', 'BYD', '10,000 Bs', '8,000 Bs', '6,000 Bs'];
      const sorted = [...gameState.players].sort((a, b) => {
        return prizeOrder.indexOf(a.prize) - prizeOrder.indexOf(b.prize);
      });

      sorted.forEach((player, i) => {
        const div = document.createElement('div');
        div.className = `result-item pos-${i + 1}`;
        div.innerHTML = `
          <div>
            <span class="result-position">#${i + 1}</span>
            <span class="result-color" style="background:${player.color};">${player.number}</span>
          </div>
          <div class="result-prize">${player.prize}</div>
        `;
        results.appendChild(div);
      });

      document.getElementById('finalModal').classList.add('active');
    }

    function handleSpecial(type, player) {
      const special = SPECIAL_TYPES.find(s => s.id === type);

      renderBoard();
      renderPlayers();
      saveGameState();

      switch (type) {
        case 'doble':
          gameState.extraTurn = true;
          showAlert(special.icon, special.name, special.desc);
          break;

        case 'revelar2':
          gameState.revealExtra = true;
          showAlert(special.icon, special.name, special.desc);
          break;

        case 'robar':
          executeRobar(player, special);
          break;

        case 'bomba':
          executeBomba(player, special);
          break;

        case 'comodin':
          showComodinChoice(player, special);
          break;

        case 'intercambio':
          executeIntercambio(player, special);
          break;

        case 'espejo':
          executeEspejo(player, special);
          break;

        case 'bloqueo':
          gameState.skipNextPlayer = true;
          showAlert(special.icon, special.name, 'El siguiente jugador perdera su turno!', nextTurn);
          break;
      }
    }

    function getValidTargets() {
      return gameState.players
        .map((p, i) => ({ ...p, index: i }))
        .filter(p => !p.protected && p.index !== gameState.currentPlayer);
    }

    function executeRobar(player, special) {
      const targets = getValidTargets().filter(p => p.aiqar > 0 || p.byd > 0);

      if (targets.length === 0) {
        showAlert(special.icon, special.name, 'No hay nadie a quien robar!', nextTurn);
        return;
      }

      // Mostrar modal para elegir a qui√©n robar
      const modal = document.getElementById('specialModal');
      document.getElementById('specialIcon').textContent = special.icon;
      document.getElementById('specialTitle').textContent = special.name;
      document.getElementById('specialDesc').textContent = 'Elige a quien robar:';

      const buttons = document.getElementById('specialButtons');
      buttons.innerHTML = targets.map(t => `
        <button class="choice-btn" style="background:${t.color};" onclick="selectRobarTarget(${t.index})">
          Jugador ${t.number}
          <span style="font-size:0.7em;display:block;">
            ${t.aiqar > 0 ? `<img src="/aiqar-logo.svg" style="width:16px;height:10px;"> ${t.aiqar}` : ''}
            ${t.byd > 0 ? `<img src="/byd-logo.png" style="width:16px;height:10px;"> ${t.byd}` : ''}
          </span>
        </button>
      `).join('');

      modal.classList.add('active');
    }

    window.selectRobarTarget = function(targetIndex) {
      const targetPlayer = gameState.players[targetIndex];
      const types = [];
      if (targetPlayer.aiqar > 0) types.push('aiqar');
      if (targetPlayer.byd > 0) types.push('byd');

      // Si solo tiene un tipo, robar directamente
      if (types.length === 1) {
        window.applyRobar(targetIndex, types[0]);
        return;
      }

      // Mostrar selecci√≥n de tipo de llanta
      document.getElementById('specialDesc').textContent = `Que llanta robar al Jugador ${targetPlayer.number}?`;
      const buttons = document.getElementById('specialButtons');
      buttons.innerHTML = `
        <button class="choice-btn aiqar" onclick="applyRobar(${targetIndex}, 'aiqar')">
          <img src="/aiqar-logo.svg" style="width:30px;height:20px;vertical-align:middle;"> AIQAR (${targetPlayer.aiqar})
        </button>
        <button class="choice-btn byd" onclick="applyRobar(${targetIndex}, 'byd')">
          <img src="/byd-logo.png" style="width:30px;height:20px;vertical-align:middle;"> BYD (${targetPlayer.byd})
        </button>
      `;
    };

    window.applyRobar = function(targetIndex, type) {
      document.getElementById('specialModal').classList.remove('active');
      const player = gameState.players[gameState.currentPlayer];
      const targetPlayer = gameState.players[targetIndex];

      targetPlayer[type]--;
      player[type]++;

      renderPlayers();
      saveGameState();

      // Verificar si gano
      if (type === 'aiqar') checkAiqarWin(player, 'aiqar');
      else checkBydWin(player, 'byd');

      showAlert('üè¥‚Äç‚ò†Ô∏è', 'ROBO EXITOSO', `Robaste 1 llanta ${type.toUpperCase()} al Jugador ${targetPlayer.number}!`, () => {
        if (!gameState.gameOver) nextTurn();
      });
    };

    function executeBomba(player, special) {
      const types = [];
      if (player.aiqar > 0) types.push('aiqar');
      if (player.byd > 0) types.push('byd');

      if (types.length === 0) {
        showAlert(special.icon, special.name, 'No tenias llantas que perder!', nextTurn);
        return;
      }

      const type = types[Math.floor(Math.random() * types.length)];
      const lost = player[type];
      player[type] = 0;

      renderPlayers();
      showAlert(special.icon, special.name, `Perdiste ${lost} llantas ${type.toUpperCase()}!`, nextTurn);
    }

    function showComodinChoice(player, special) {
      const modal = document.getElementById('specialModal');
      document.getElementById('specialIcon').textContent = special.icon;
      document.getElementById('specialTitle').textContent = special.name;
      document.getElementById('specialDesc').textContent = 'Elige que tipo de llanta quieres:';

      const buttons = document.getElementById('specialButtons');
      buttons.innerHTML = `
        <button class="choice-btn aiqar" onclick="applyComodin('aiqar')"><img src="/aiqar-logo.svg" style="width:30px;height:20px;vertical-align:middle;"> AIQAR</button>
        <button class="choice-btn byd" onclick="applyComodin('byd')"><img src="/byd-logo.png" style="width:30px;height:20px;vertical-align:middle;"> BYD</button>
      `;

      modal.classList.add('active');
    }

    window.applyComodin = function(type) {
      document.getElementById('specialModal').classList.remove('active');
      const player = gameState.players[gameState.currentPlayer];
      player[type]++;

      renderPlayers();

      if (type === 'aiqar') checkAiqarWin(player, 'aiqar');
      else checkBydWin(player, 'byd');

      if (!gameState.gameOver) nextTurn();
    };

    function executeIntercambio(player, special) {
      const targets = getValidTargets();

      if (targets.length === 0) {
        showAlert(special.icon, special.name, 'No hay con quien intercambiar!', nextTurn);
        return;
      }

      // AMA√ëADO: Si el jugador va perdiendo, intercambiar con el l√≠der
      const playerTotal = player.aiqar + player.byd;
      const avgTotal = gameState.players.reduce((sum, p) => sum + p.aiqar + p.byd, 0) / gameState.players.length;

      let target;
      if (playerTotal < avgTotal && Math.random() < 0.8) {
        // Jugador va perdiendo: intercambiar con el l√≠der
        target = targets.reduce((leader, p) => {
          const pTotal = p.aiqar + p.byd;
          const leaderTotal = leader.aiqar + leader.byd;
          return pTotal > leaderTotal ? p : leader;
        }, targets[0]);
      } else {
        target = targets[Math.floor(Math.random() * targets.length)];
      }
      const targetPlayer = gameState.players[target.index];

      // Intercambiar
      const tempAiqar = player.aiqar;
      const tempByd = player.byd;
      player.aiqar = targetPlayer.aiqar;
      player.byd = targetPlayer.byd;
      targetPlayer.aiqar = tempAiqar;
      targetPlayer.byd = tempByd;

      renderPlayers();

      // Verificar si alguien gano
      checkAiqarWin(player, 'aiqar');
      checkBydWin(player, 'byd');

      showAlert(special.icon, special.name, `Intercambiaste llantas con Jugador ${targetPlayer.number}!`, () => {
        if (!gameState.gameOver) nextTurn();
      });
    }

    function executeEspejo(player, special) {
      const targets = getValidTargets();

      if (targets.length === 0) {
        showAlert(special.icon, special.name, 'No hay a quien copiar!', nextTurn);
        return;
      }

      // AMA√ëADO: Siempre copiar al l√≠der para igualar el juego
      let target;
      if (Math.random() < 0.85) {
        target = targets.reduce((leader, p) => {
          const pTotal = p.aiqar + p.byd;
          const leaderTotal = leader.aiqar + leader.byd;
          return pTotal > leaderTotal ? p : leader;
        }, targets[0]);
      } else {
        target = targets[Math.floor(Math.random() * targets.length)];
      }
      const targetPlayer = gameState.players[target.index];

      player.aiqar = targetPlayer.aiqar;
      player.byd = targetPlayer.byd;

      renderPlayers();

      checkAiqarWin(player, 'aiqar');
      checkBydWin(player, 'byd');

      showAlert(special.icon, special.name, `Copiaste las llantas del Jugador ${targetPlayer.number}!`, () => {
        if (!gameState.gameOver) nextTurn();
      });
    }

    let alertCallback = null;

    function showAlert(icon, title, desc, callback = null) {
      document.getElementById('alertIcon').textContent = icon;
      document.getElementById('alertTitle').textContent = title;
      document.getElementById('alertDesc').textContent = desc;
      document.getElementById('alertModal').classList.add('active');
      alertCallback = callback;
    }

    function closeAlertAndContinue() {
      document.getElementById('alertModal').classList.remove('active');
      if (alertCallback) {
        const cb = alertCallback;
        alertCallback = null;
        cb();
      }
    }

    function checkAlerts() {
      // Solo actualizar panel de progreso - las alertas temporales se manejan aparte
      updateProgressPanel();
    }

    function updateProgressPanel() {
      const panel = document.getElementById('progressPanel');
      if (!panel) return;

      let html = '';

      if (gameState.mode === 'coleccion') {
        // Modo 1: Mostrar progreso de piezas
        const aiqarWon = gameState.aiqarWinner !== null;
        const bydWon = gameState.bydWinner !== null;
        const aiqarWarning = gameState.aiqarPiecesFound === 4 && !aiqarWon;
        const bydWarning = gameState.bydPiecesFound === 4 && !bydWon;

        html += `<div class="progress-item aiqar-prog ${aiqarWon ? 'winner' : ''} ${aiqarWarning ? 'warning' : ''}">`;
        html += `<img src="/aiqar-logo.svg" style="width:20px;height:12px;vertical-align:middle;"> `;
        if (aiqarWon) {
          html += `üèÜ J${gameState.players[gameState.aiqarWinner].number}`;
        } else {
          html += `${gameState.aiqarPiecesFound}/5`;
        }
        html += `</div>`;

        html += `<div class="progress-item byd-prog ${bydWon ? 'winner' : ''} ${bydWarning ? 'warning' : ''}">`;
        html += `<img src="/byd-logo.png" style="width:20px;height:12px;vertical-align:middle;"> `;
        if (bydWon) {
          html += `üèÜ J${gameState.players[gameState.bydWinner].number}`;
        } else {
          html += `${gameState.bydPiecesFound}/5`;
        }
        html += `</div>`;
      } else {
        // Modo 2 y 3: Solo mostrar cuando alguien est√° cerca (3/4) o gan√≥
        // AIQAR
        if (gameState.aiqarWinner !== null) {
          html += `<div class="progress-item aiqar-prog winner"><img src="/aiqar-logo.svg" style="width:20px;height:12px;vertical-align:middle;"> üèÜ J${gameState.players[gameState.aiqarWinner].number}</div>`;
        } else {
          const maxAiqar = Math.max(...gameState.players.map(p => p.aiqar));
          if (maxAiqar >= 3) {
            const leader = gameState.players.find(p => p.aiqar === maxAiqar);
            html += `<div class="progress-item aiqar-prog warning"><img src="/aiqar-logo.svg" style="width:20px;height:12px;vertical-align:middle;"> ‚ö†Ô∏è J${leader.number}: ${maxAiqar}/4</div>`;
          }
        }
        // BYD
        if (gameState.bydWinner !== null) {
          html += `<div class="progress-item byd-prog winner"><img src="/byd-logo.png" style="width:20px;height:12px;vertical-align:middle;"> üèÜ J${gameState.players[gameState.bydWinner].number}</div>`;
        } else {
          const maxByd = Math.max(...gameState.players.map(p => p.byd));
          if (maxByd >= 3) {
            const leader = gameState.players.find(p => p.byd === maxByd);
            html += `<div class="progress-item byd-prog warning"><img src="/byd-logo.png" style="width:20px;height:12px;vertical-align:middle;"> ‚ö†Ô∏è J${leader.number}: ${maxByd}/4</div>`;
          }
        }
      }

      panel.innerHTML = html;
    }

    function nextTurn() {
      if (gameState.gameOver) return;

      gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;

      // Saltar si esta bloqueado
      if (gameState.skipNextPlayer) {
        gameState.skipNextPlayer = false;
        showAlert('üö´', 'TURNO PERDIDO', `Jugador ${gameState.players[gameState.currentPlayer].number} pierde su turno!`);
        gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
      }

      // Saltar jugadores que ya ganaron
      while (gameState.players[gameState.currentPlayer].protected) {
        gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
      }

      updateCurrentPlayer();
      renderPlayers();
      saveGameState();
    }

    function updateCurrentPlayer() {
      const badge = document.getElementById('currentPlayerBadge');
      const player = gameState.players[gameState.currentPlayer];
      badge.textContent = player.number;
      badge.style.background = player.color;

      // Cambiar borde del tablero al color del jugador
      const board = document.getElementById('board');
      board.style.borderColor = player.color;
      board.style.boxShadow = `0 0 30px ${player.color}80`;
    }

    function renderPlayers() {
      const panel = document.getElementById('playersPanel');
      panel.innerHTML = '';

      gameState.players.forEach((player, i) => {
        const card = document.createElement('div');
        let cardClass = 'player-card';
        const isActive = i === gameState.currentPlayer && !player.protected;
        if (isActive) cardClass += ' active';
        if (player.prize === 'AIQAR') cardClass += ' winner-aiqar';
        else if (player.prize === 'BYD') cardClass += ' winner-byd';
        else if (player.prize) cardClass += ' winner-vale';

        card.className = cardClass;

        // Si es el jugador activo, aplicar su color al borde y fondo
        if (isActive) {
          card.style.borderLeft = `4px solid ${player.color}`;
          card.style.background = `${player.color}40`; // 40 = 25% opacity
          card.style.boxShadow = `inset 0 0 15px ${player.color}60`;
        }

        card.innerHTML = `
          <div class="player-number" style="background:${player.color};">${player.number}</div>
          <div class="player-stats">
            <div class="stat-row aiqar-row">
              <img src="/aiqar-logo.svg" style="width:22px;height:14px;">
              <span class="stat-num">${player.aiqar}</span>
            </div>
            <div class="stat-row byd-row">
              <img src="/byd-logo.png" style="width:22px;height:14px;">
              <span class="stat-num">${player.byd}</span>
            </div>
          </div>
          ${player.prize ? `<span style="font-size:0.4rem;">üèÜ</span>` : ''}
        `;
        panel.appendChild(card);
      });
    }

    // Estado para saber si el tablero est√° revelado
    let boardPreviewMode = false;

    window.confirmRevealAll = function() {
      if (boardPreviewMode) {
        // Si ya est√° revelado, ocultar sin confirmaci√≥n
        hideAllBoard();
      } else {
        document.getElementById('confirmRevealModal').classList.add('active');
      }
    };

    window.closeConfirmReveal = function() {
      document.getElementById('confirmRevealModal').classList.remove('active');
    };

    window.revealAllBoard = function() {
      document.getElementById('confirmRevealModal').classList.remove('active');
      boardPreviewMode = true;

      // Cambiar icono del bot√≥n
      document.querySelector('.btn-reveal').textContent = 'üôà';

      // Mostrar todas las casillas con animaci√≥n
      const board = document.getElementById('board');
      const cells = board.querySelectorAll('.cell');

      cells.forEach((cell, i) => {
        if (!gameState.revealed[i]) {
          // Animaci√≥n escalonada
          setTimeout(() => {
            const itemType = gameState.board[i];
            const type = itemType.split('-')[0];

            // Animaci√≥n de volteo
            cell.style.transform = 'rotateY(90deg)';

            setTimeout(() => {
              cell.classList.add('preview-revealed', type === 'special' ? 'special' : itemType);
              cell.innerHTML = '';
              applyCellBackground(cell, itemType);
              cell.style.opacity = '0.7';
              cell.style.border = '2px dashed #fff';
              cell.style.transform = 'rotateY(0deg)';
            }, 150);
          }, i * 30);
        }
      });
    };

    function hideAllBoard() {
      boardPreviewMode = false;

      // Cambiar icono del bot√≥n
      document.querySelector('.btn-reveal').textContent = 'üëÅ';

      // Ocultar casillas no jugadas con animaci√≥n
      const board = document.getElementById('board');
      const cells = board.querySelectorAll('.cell');

      cells.forEach((cell, i) => {
        if (!gameState.revealed[i]) {
          setTimeout(() => {
            cell.style.transform = 'rotateY(90deg)';

            setTimeout(() => {
              // Quitar clases y estilos de preview
              cell.className = 'cell';
              cell.style.opacity = '';
              cell.style.border = '';
              cell.style.background = '';
              cell.style.backgroundImage = '';
              cell.style.backgroundSize = '';
              cell.style.backgroundPosition = '';
              cell.style.backgroundRepeat = '';
              cell.innerHTML = '<span style="font-size:clamp(16px, 5vw, 32px);color:#FFD700;text-shadow:0 0 10px #FFB81C, 2px 2px 0 #4A1F56;font-weight:bold;display:flex;align-items:center;justify-content:center;width:100%;height:100%;">?</span>';
              cell.style.transform = 'rotateY(0deg)';
            }, 150);
          }, i * 20);
        }
      });
    }

    window.resetGame = function() {
      boardPreviewMode = false;
      document.getElementById('finalModal').classList.remove('active');
      document.getElementById('specialModal').classList.remove('active');
      document.getElementById('alertModal').classList.remove('active');
      document.getElementById('confirmRevealModal').classList.remove('active');
      document.getElementById('gameArea').classList.remove('active');
      document.querySelector('.container').classList.remove('fullscreen');
      document.getElementById('setup').style.display = 'block';
      const revealBtn = document.querySelector('.btn-reveal');
      if (revealBtn) revealBtn.textContent = 'üëÅ';
      clearSavedGame();
    };

    // === PERSISTENCIA DEL JUEGO ===
    const STORAGE_KEY = 'juegoLlantasState';

    function saveGameState() {
      const state = {
        gameState: gameState,
        boardPreviewMode: boardPreviewMode,
        timestamp: Date.now()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadSavedGame() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return null;
      try {
        return JSON.parse(saved);
      } catch (e) {
        return null;
      }
    }

    function clearSavedGame() {
      localStorage.removeItem(STORAGE_KEY);
    }

    function restoreGame(saved) {
      gameState = saved.gameState;
      boardPreviewMode = saved.boardPreviewMode || false;

      document.getElementById('setup').style.display = 'none';
      document.getElementById('gameArea').classList.add('active');
      document.querySelector('.container').classList.add('fullscreen');

      updateLegend();
      renderBoard();
      renderPlayers();
      updateCurrentPlayer();
      updateProgressPanel();
    }

    // Preguntar antes de salir si hay juego en progreso
    window.addEventListener('beforeunload', (e) => {
      if (gameState.players.length > 0 && !gameState.gameOver) {
        saveGameState();
        e.preventDefault();
        e.returnValue = '';
      }
    });

    // Verificar al cargar si hay juego guardado
    window.addEventListener('load', () => {
      const saved = loadSavedGame();
      if (saved && saved.gameState.players.length > 0 && !saved.gameState.gameOver) {
        if (confirm('Hay un juego en progreso guardado. ¬øDeseas continuar donde lo dejaste?')) {
          restoreGame(saved);
        } else {
          clearSavedGame();
        }
      }
    });
  </script>
</body>
</html>
