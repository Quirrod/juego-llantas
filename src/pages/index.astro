---
const title = "Juego de Llantas - Gana un Auto!";
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    :root {
      --breick-purple: #6B2D7B;
      --breick-purple-dark: #4A1F56;
      --breick-purple-light: #8B4D9B;
      --breick-yellow: #FFB81C;
      --breick-yellow-light: #FFD54F;
      --breick-yellow-dark: #E6A000;
    }

    body {
      font-family: 'Press Start 2P', cursive;
      background: linear-gradient(135deg, var(--breick-purple-dark) 0%, var(--breick-purple) 50%, var(--breick-purple-dark) 100%);
      min-height: 100vh;
      color: #fff;
      image-rendering: pixelated;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0.5rem;
      height: 100%;
      overflow-y: auto;
    }

    .container.fullscreen {
      max-width: 100%;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 0;
      overflow: hidden;
    }

    header {
      text-align: center;
      padding: 0.5rem 0;
      border-bottom: 4px solid var(--breick-yellow);
      margin-bottom: 0.5rem;
      background: linear-gradient(180deg, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
    }

    h1 {
      font-size: clamp(0.6rem, 2.5vw, 1rem);
      color: var(--breick-yellow);
      text-shadow: 3px 3px 0px var(--breick-purple-dark);
    }

    .setup-panel {
      background: linear-gradient(180deg, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
      border: 4px solid var(--breick-yellow);
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 0 20px rgba(107, 45, 123, 0.5);
    }

    .setup-title {
      text-align: center;
      color: var(--breick-yellow);
      font-size: 0.7rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 0px var(--breick-purple-dark);
    }

    .mode-selector {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .mode-btn {
      padding: 0.8rem;
      border: 4px solid var(--breick-purple-light);
      background: var(--breick-purple-dark);
      color: #fff;
      cursor: pointer;
      transition: all 0.1s;
      text-align: left;
    }

    .mode-btn:hover {
      border-color: var(--breick-yellow);
      transform: translate(-2px, -2px);
      box-shadow: 4px 4px 0px var(--breick-yellow);
    }

    .mode-btn.active {
      border-color: var(--breick-yellow);
      background: var(--breick-purple-light);
      box-shadow: 4px 4px 0px var(--breick-yellow-dark);
    }

    .mode-btn h3 {
      color: var(--breick-yellow);
      font-size: 0.6rem;
      margin-bottom: 0.3rem;
    }

    .mode-btn p {
      font-size: 0.45rem;
      opacity: 0.8;
      line-height: 1.4;
    }

    .setup-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .setup-group {
      flex: 1;
      min-width: 150px;
    }

    .setup-group label {
      display: block;
      margin-bottom: 0.3rem;
      font-size: 0.5rem;
      color: var(--breick-yellow);
    }

    .setup-group input {
      width: 100%;
      padding: 0.5rem;
      border: 4px solid var(--breick-purple-light);
      background: var(--breick-purple-dark);
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.5rem;
    }

    .setup-group input:focus {
      outline: none;
      border-color: var(--breick-yellow);
    }

    .prizes-preview {
      background: var(--breick-purple-dark);
      border: 4px solid var(--breick-purple-light);
      padding: 0.8rem;
      margin-bottom: 1rem;
    }

    .prizes-preview h4 {
      color: var(--breick-yellow);
      font-size: 0.5rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .prize-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    .prize-item {
      padding: 0.4rem 0.6rem;
      border: 2px solid;
      font-size: 0.4rem;
      text-align: center;
    }

    .prize-item.aiqar { border-color: #00BFFF; color: #00BFFF; }
    .prize-item.byd { border-color: #FF4500; color: #FF4500; }
    .prize-item.vale { border-color: #00FF00; color: #00FF00; }

    .players-preview {
      background: var(--breick-purple-dark);
      border: 4px solid var(--breick-purple-light);
      padding: 0.8rem;
      margin-bottom: 1rem;
    }

    .players-preview h4 {
      color: var(--breick-yellow);
      font-size: 0.5rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .color-list {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }

    .color-item {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
      border: 4px solid #000;
    }

    .btn-start {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(180deg, var(--breick-yellow) 0%, var(--breick-yellow-dark) 100%);
      border: 4px solid var(--breick-purple);
      color: var(--breick-purple-dark);
      font-family: 'Press Start 2P', cursive;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.1s;
    }

    .btn-start:hover {
      transform: translate(-2px, -2px);
      box-shadow: 4px 4px 0px var(--breick-purple);
      background: linear-gradient(180deg, var(--breick-yellow-light) 0%, var(--breick-yellow) 100%);
    }

    .btn-start:active {
      transform: translate(0, 0);
      box-shadow: none;
    }

    .game-area {
      display: none;
    }

    .game-area.active {
      display: flex;
      flex-direction: column;
      flex: 1;
      height: 100%;
      overflow: hidden;
    }

    .game-top-bar {
      display: flex;
      justify-content: space-between;
      align-items: stretch;
      background: linear-gradient(180deg, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
      border-bottom: 3px solid var(--breick-yellow);
      flex-shrink: 0;
    }

    .game-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.3rem 0.6rem;
      border-right: 2px solid var(--breick-yellow);
    }

    .turn-label {
      font-size: 0.35rem;
      opacity: 0.8;
    }

    .current-player-badge {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.4rem;
      background: rgba(255,184,28,0.2);
      border: 2px solid var(--breick-yellow);
      border-radius: 4px;
    }

    .current-player-num {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
      color: #000;
      border-radius: 4px;
    }

    .turn-arrow {
      font-size: 0.8rem;
      animation: bounce-arrow 1s ease-in-out infinite;
    }

    @keyframes bounce-arrow {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(3px); }
    }

    .btn-restart {
      padding: 0.5rem 0.8rem;
      background: rgba(255,50,50,0.3);
      border: none;
      border-left: 2px solid var(--breick-yellow);
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.6rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-restart:hover {
      background: rgba(255,50,50,0.5);
    }

    .players-panel {
      display: flex;
      flex: 1;
      gap: 0;
    }

    .player-card {
      flex: 1;
      padding: 0.2rem;
      background: transparent;
      border: none;
      border-left: 2px solid var(--breick-purple-light);
      text-align: center;
      transition: all 0.1s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.15rem;
    }

    .player-card:first-child {
      border-left: 2px solid var(--breick-yellow);
    }

    .player-card.active {
      background: rgba(255, 184, 28, 0.25);
      border-left-color: var(--breick-yellow) !important;
      box-shadow: inset 0 0 10px rgba(255, 184, 28, 0.3);
    }

    .player-card.winner-aiqar {
      background: rgba(0, 191, 255, 0.25);
    }

    .player-card.winner-byd {
      background: rgba(255, 69, 0, 0.25);
    }

    .player-card.winner-vale {
      background: rgba(0, 255, 0, 0.25);
    }

    .player-number {
      font-size: 0.7rem;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-weight: bold;
      border-radius: 4px;
      border: 2px solid rgba(0,0,0,0.3);
    }

    .player-stats {
      display: flex;
      gap: 0.2rem;
      align-items: center;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 1px;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 0.35rem;
      font-weight: bold;
    }

    .stat-item.aiqar {
      background: linear-gradient(135deg, #00BFFF 0%, #0080CC 100%);
      color: #fff;
    }

    .stat-item.byd {
      background: linear-gradient(135deg, #FF4500 0%, #CC2200 100%);
      color: #fff;
    }

    .stat-item.breick {
      background: linear-gradient(135deg, var(--breick-yellow) 0%, var(--breick-yellow-dark) 100%);
      color: var(--breick-purple-dark);
    }

    .stat-icon {
      width: 12px;
      height: 12px;
      object-fit: contain;
    }

    .stat-icon-text {
      font-size: 0.4rem;
    }

    .player-prize {
      font-size: 0.25rem;
      color: var(--breick-yellow);
      background: rgba(0,0,0,0.3);
      padding: 1px 4px;
      border-radius: 2px;
    }

    .alert-box {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 1rem 2rem;
      border: 4px solid var(--breick-yellow);
      text-align: center;
      font-size: 0.6rem;
      background: var(--breick-purple-dark);
      z-index: 500;
      animation: pulse-alert 0.5s infinite;
      border-radius: 8px;
      box-shadow: 0 0 30px rgba(255, 184, 28, 0.5);
    }

    .alert-box.active {
      display: block;
    }

    .alert-box.warning {
      border-color: var(--breick-yellow);
      color: var(--breick-yellow);
    }

    @keyframes pulse-alert {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.02); }
    }

    .board-container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex: 1;
      overflow: hidden;
      padding: 0.5rem;
      background: radial-gradient(ellipse at center, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
    }

    .board {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 6px;
      background: var(--breick-yellow);
      padding: 6px;
      border: 4px solid var(--breick-yellow);
      box-shadow: 0 0 30px rgba(255, 184, 28, 0.4);
      width: min(calc(100vw - 1rem), calc(100vh - 80px));
      height: min(calc(100vw - 1rem), calc(100vh - 80px));
      max-width: 100%;
      max-height: 100%;
    }

    .cell {
      background: linear-gradient(145deg, var(--breick-purple-light) 0%, var(--breick-purple) 50%, var(--breick-purple-dark) 100%);
      border: 3px solid var(--breick-purple-dark);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(1rem, 5vw, 3rem);
      transition: all 0.15s ease;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.15), inset 0 -2px 4px rgba(0,0,0,0.4), 0 2px 4px rgba(0,0,0,0.3);
    }

    .cell:hover:not(.revealed) {
      background: linear-gradient(145deg, var(--breick-yellow-light) 0%, var(--breick-yellow) 50%, var(--breick-yellow-dark) 100%);
      border-color: var(--breick-purple-dark);
      transform: scale(1.05);
      z-index: 10;
      box-shadow: 0 0 15px rgba(255, 184, 28, 0.6), 0 4px 8px rgba(0,0,0,0.4);
    }

    .cell.revealed {
      cursor: default;
      transform: none;
      border-color: var(--breick-purple-dark);
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.4);
    }

    .cell.aiqar {
      background: linear-gradient(145deg, #0090c0 0%, #007099 50%, #005070 100%);
      border-color: #00BFFF;
    }

    .cell.byd {
      background: linear-gradient(145deg, #c03500 0%, #a02500 50%, #801500 100%);
      border-color: #FF4500;
    }

    .cell.brick {
      background: linear-gradient(145deg, #f5f5f5 0%, #e0e0e0 50%, #d0d0d0 100%);
      border-color: #aaa;
    }

    .cell.key-aiqar {
      background: linear-gradient(145deg, #00a070 0%, #008050 50%, #006040 100%);
      border-color: #00FF80;
    }

    .cell.key-byd {
      background: linear-gradient(145deg, #a000a0 0%, #800080 50%, #600060 100%);
      border-color: #FF00FF;
    }

    .cell.special {
      background: linear-gradient(145deg, var(--breick-yellow-light) 0%, var(--breick-yellow) 50%, var(--breick-yellow-dark) 100%);
      border-color: var(--breick-purple);
    }

    .cell-content {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      pointer-events: none;
      padding: 8%;
    }

    .cell-hidden {
      color: var(--breick-yellow);
      font-size: clamp(1.2rem, 5vw, 2.5rem);
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255,184,28,0.8), 2px 2px 0 var(--breick-purple-dark);
      animation: pulse-question 1.5s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    @keyframes pulse-question {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    .cell:not(.revealed) {
      cursor: pointer;
    }

    .tire-cell {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 5%;
    }

    .tire-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.6));
    }

    .brand-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 45%;
      height: 45%;
      object-fit: contain;
      z-index: 5;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.9));
    }

    .breick-cell {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10%;
    }

    .breick-logo {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 1px 3px rgba(0,0,0,0.5));
    }

    .cell .owner-dot {
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 8px;
      height: 8px;
      border-radius: 0;
      border: 1px solid #000;
    }

    .legend {
      display: none;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(180deg, var(--breick-purple) 0%, var(--breick-purple-dark) 100%);
      padding: 1.5rem;
      border: 8px solid var(--breick-yellow);
      text-align: center;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(255, 184, 28, 0.4);
    }

    .modal h2 {
      font-size: 0.8rem;
      color: var(--breick-yellow);
      margin-bottom: 1rem;
      text-shadow: 3px 3px 0px var(--breick-purple-dark);
    }

    .final-results {
      margin: 1rem 0;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      margin-bottom: 0.3rem;
      border: 4px solid;
      font-size: 0.4rem;
    }

    .result-item.pos-1 { border-color: #00BFFF; background: rgba(0, 191, 255, 0.2); }
    .result-item.pos-2 { border-color: #FF4500; background: rgba(255, 69, 0, 0.2); }
    .result-item.pos-3 { border-color: #00FF00; background: rgba(0, 255, 0, 0.2); }
    .result-item.pos-4 { border-color: #00CC00; background: rgba(0, 204, 0, 0.2); }
    .result-item.pos-5 { border-color: #009900; background: rgba(0, 153, 0, 0.2); }

    .result-position {
      font-size: 0.6rem;
    }

    .result-prize {
      font-size: 0.5rem;
      color: var(--breick-yellow);
    }

    .result-color {
      display: inline-block;
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
      color: #000;
      font-weight: bold;
      margin-right: 0.5rem;
    }

    .special-modal {
      max-width: 400px;
    }

    .special-modal h3 {
      color: var(--breick-yellow);
      font-size: 0.6rem;
      margin-bottom: 0.5rem;
    }

    .special-modal p {
      font-size: 0.4rem;
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .special-icon {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }

    .choice-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    .choice-btn {
      padding: 0.5rem 1rem;
      border: 4px solid var(--breick-purple-light);
      background: var(--breick-purple-dark);
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.4rem;
      cursor: pointer;
    }

    .choice-btn:hover {
      border-color: var(--breick-yellow);
      background: var(--breick-purple);
    }

    .choice-btn.aiqar { border-color: #00BFFF; }
    .choice-btn.byd { border-color: #FF4500; }

    .skip-turn {
      background: #333;
      border-color: #666;
      color: #999;
    }

    @media (max-width: 768px) {
      .game-top-bar {
        flex-wrap: nowrap;
      }

      .game-header {
        padding: 0.2rem 0.4rem;
      }

      .players-panel {
        flex: 1;
        overflow-x: auto;
      }

      .player-card {
        padding: 0.15rem;
        min-width: 50px;
      }

      .player-number {
        width: 20px;
        height: 20px;
        font-size: 0.55rem;
      }

      .player-stats {
        gap: 0.1rem;
      }

      .stat-item {
        padding: 1px 2px;
        font-size: 0.3rem;
      }

      .stat-icon {
        width: 8px;
        height: 8px;
      }

      .stat-icon-text {
        font-size: 0.3rem;
      }

      .current-player-num {
        width: 20px;
        height: 20px;
        font-size: 0.55rem;
      }

      .turn-arrow {
        font-size: 0.6rem;
      }

      .board {
        gap: 4px;
        padding: 4px;
      }

      .cell {
        border-width: 2px;
        border-radius: 4px;
      }
    }

    @media (max-width: 480px) {
      .player-stats {
        flex-direction: column;
        gap: 1px;
      }

      .stat-item {
        padding: 1px 3px;
      }

      .player-number {
        width: 18px;
        height: 18px;
        font-size: 0.5rem;
      }

      .board {
        gap: 3px;
        padding: 3px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üèéÔ∏è JUEGO DE LLANTAS üèéÔ∏è</h1>
    </header>

    <!-- Panel de Configuracion -->
    <div class="setup-panel" id="setup">
      <div class="setup-title">CONFIGURACION</div>

      <div class="mode-selector">
        <div class="mode-btn active" data-mode="coleccion">
          <h3>MODO 1: COLECCION</h3>
          <p>Junta 4 llantas del mismo auto para ganarlo. Aiqar es mas facil, BYD mas dificil.</p>
        </div>
        <div class="mode-btn" data-mode="ultima">
          <h3>MODO 2: ULTIMA PIEZA</h3>
          <p>Encuentra la LLAVE de un auto para ganarlo. Hay llantas y una llave por auto.</p>
        </div>
        <div class="mode-btn" data-mode="caos">
          <h3>MODO 3: CAOS</h3>
          <p>Como Coleccion pero con casillas especiales: robar, bomba, comodin, intercambio y mas!</p>
        </div>
      </div>

      <div class="prizes-preview">
        <h4>üèÜ PREMIOS üèÜ</h4>
        <div class="prize-list">
          <div class="prize-item aiqar">1ro: AIQAR</div>
          <div class="prize-item byd">2do: BYD</div>
          <div class="prize-item vale">3ro: 10,000 Bs</div>
          <div class="prize-item vale">4to: 8,000 Bs</div>
          <div class="prize-item vale">5to: 6,000 Bs</div>
        </div>
      </div>

      <div class="players-preview">
        <h4>JUGADORES</h4>
        <div class="color-list">
          <div class="color-item" style="background: #FF6B6B;">1</div>
          <div class="color-item" style="background: #4ECDC4;">2</div>
          <div class="color-item" style="background: #FFE66D; color: #000;">3</div>
          <div class="color-item" style="background: #95E1D3;">4</div>
          <div class="color-item" style="background: #DDA0DD;">5</div>
        </div>
      </div>

      <button class="btn-start" id="startGame">‚ñ∂ INICIAR JUEGO</button>
    </div>

    <!-- Area de Juego -->
    <div class="game-area" id="gameArea">
      <div class="game-top-bar">
        <div class="game-header">
          <span class="turn-arrow">‚ñ∂</span>
          <div class="current-player-badge">
            <div class="current-player-num" id="currentPlayerBadge">1</div>
          </div>
        </div>
        <div class="players-panel" id="playersPanel"></div>
        <button class="btn-restart" onclick="resetGame()">‚úï</button>
      </div>

      <div class="alert-box" id="alertBox"></div>

      <div class="legend" id="legend">
        <div class="legend-item">
          <div class="legend-icon" style="background:#006090;border-color:#00BFFF;font-size:0.4rem;color:#00BFFF;">A</div>
          <span>AIQAR</span>
        </div>
        <div class="legend-item">
          <div class="legend-icon" style="background:#902000;border-color:#FF4500;font-size:0.4rem;color:#FF4500;">B</div>
          <span>BYD</span>
        </div>
        <div class="legend-item">
          <div class="legend-icon" style="background:linear-gradient(135deg, #8B4513, #D2691E);border-color:#654321;font-size:0.3rem;color:#FFD700;">BR</div>
          <span>BREICK</span>
        </div>
        <div class="legend-item legend-key" style="display:none;">
          <div class="legend-icon" style="background:#006040;border-color:#00FF80;">üîë</div>
          <span>LLAVE A</span>
        </div>
        <div class="legend-item legend-key" style="display:none;">
          <div class="legend-icon" style="background:#600060;border-color:#FF00FF;">üîë</div>
          <span>LLAVE B</span>
        </div>
        <div class="legend-item legend-special" style="display:none;">
          <div class="legend-icon" style="background:#604000;border-color:#FFD700;">‚≠ê</div>
          <span>ESPECIAL</span>
        </div>
      </div>

      <div class="board-container">
        <div class="board" id="board"></div>
      </div>
    </div>
  </div>

  <!-- Modal Final -->
  <div class="modal" id="finalModal">
    <div class="modal-content">
      <h2>üèÜ RESULTADOS FINALES üèÜ</h2>
      <div class="final-results" id="finalResults"></div>
      <button class="btn-start" onclick="resetGame()">JUGAR DE NUEVO</button>
    </div>
  </div>

  <!-- Modal Especial -->
  <div class="modal" id="specialModal">
    <div class="modal-content special-modal">
      <div class="special-icon" id="specialIcon"></div>
      <h3 id="specialTitle"></h3>
      <p id="specialDesc"></p>
      <div class="choice-buttons" id="specialButtons"></div>
    </div>
  </div>

  <!-- Modal Alerta -->
  <div class="modal" id="alertModal">
    <div class="modal-content special-modal">
      <div class="special-icon" id="alertIcon"></div>
      <h3 id="alertTitle"></h3>
      <p id="alertDesc"></p>
      <button class="btn-start" id="alertOk">OK</button>
    </div>
  </div>

  <script>
    // Colores de jugadores
    const PLAYER_COLORS = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#DDA0DD'];

    // Tipos especiales
    const SPECIAL_TYPES = [
      { id: 'doble', icon: 'üîÑ', name: 'DOBLE TURNO', desc: 'Juegas otra vez!' },
      { id: 'robar', icon: 'üè¥‚Äç‚ò†Ô∏è', name: 'ROBAR', desc: 'Robas 1 llanta a un jugador al azar' },
      { id: 'revelar2', icon: 'üëÄ', name: 'REVELAR 2', desc: 'Puedes abrir otra casilla' },
      { id: 'bomba', icon: 'üí£', name: 'BOMBA', desc: 'Pierdes todas tus llantas de un tipo al azar' },
      { id: 'comodin', icon: 'üÉè', name: 'COMODIN', desc: 'Cuenta como llanta del tipo que elijas' },
      { id: 'intercambio', icon: 'üîÄ', name: 'INTERCAMBIO', desc: 'Intercambias llantas con jugador al azar' },
      { id: 'espejo', icon: 'ü™û', name: 'ESPEJO', desc: 'Copias las llantas de un jugador al azar' },
      { id: 'bloqueo', icon: 'üö´', name: 'BLOQUEO', desc: 'El siguiente jugador pierde su turno' }
    ];

    // Estado del juego
    let gameState = {
      mode: 'coleccion',
      players: [],
      currentPlayer: 0,
      board: [],
      revealed: [],
      cellOwners: [],
      gameOver: false,
      aiqarWinner: null,
      bydWinner: null,
      skipNextPlayer: false,
      extraTurn: false,
      revealExtra: false
    };

    // Configuracion
    const CONFIG = {
      boardSize: 10,
      aiqarTires: 16,
      bydTires: 8,
      specialCells: 12
    };

    // Inicializacion
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          gameState.mode = btn.dataset.mode;
          updateLegend();
        });
      });

      document.getElementById('startGame').addEventListener('click', startGame);
      document.getElementById('alertOk').addEventListener('click', () => {
        document.getElementById('alertModal').classList.remove('active');
      });
    });

    function updateLegend() {
      document.querySelectorAll('.legend-key').forEach(el => {
        el.style.display = gameState.mode === 'ultima' ? 'flex' : 'none';
      });
      document.querySelectorAll('.legend-special').forEach(el => {
        el.style.display = gameState.mode === 'caos' ? 'flex' : 'none';
      });
    }

    function startGame() {
      gameState.players = PLAYER_COLORS.map((color, i) => ({
        number: i + 1,
        aiqar: 0,
        byd: 0,
        bricks: 0,
        prize: null,
        protected: false,
        color: color
      }));

      gameState.currentPlayer = 0;
      gameState.gameOver = false;
      gameState.aiqarWinner = null;
      gameState.bydWinner = null;
      gameState.skipNextPlayer = false;
      gameState.extraTurn = false;
      gameState.revealExtra = false;

      generateBoard();

      document.getElementById('setup').style.display = 'none';
      document.getElementById('gameArea').classList.add('active');
      document.querySelector('.container').classList.add('fullscreen');

      updateLegend();
      renderBoard();
      renderPlayers();
      updateCurrentPlayer();
    }

    function generateBoard() {
      const totalCells = CONFIG.boardSize * CONFIG.boardSize;
      let items = [];

      // Llantas Aiqar
      for (let i = 0; i < CONFIG.aiqarTires; i++) items.push('aiqar');

      // Llantas BYD
      for (let i = 0; i < CONFIG.bydTires; i++) items.push('byd');

      // Llaves en modo ultima
      if (gameState.mode === 'ultima') {
        items.push('key-aiqar');
        items.push('key-byd');
      }

      // Especiales en modo caos
      if (gameState.mode === 'caos') {
        for (let i = 0; i < CONFIG.specialCells; i++) {
          const type = SPECIAL_TYPES[Math.floor(Math.random() * SPECIAL_TYPES.length)];
          items.push('special-' + type.id);
        }
      }

      // Rellenar con bricks
      while (items.length < totalCells) items.push('brick');

      // Mezclar
      gameState.board = shuffleArray(items);
      gameState.revealed = new Array(totalCells).fill(false);
      gameState.cellOwners = new Array(totalCells).fill(null);
    }

    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function renderBoard() {
      const board = document.getElementById('board');
      board.innerHTML = '';

      for (let i = 0; i < gameState.board.length; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = i;

        if (gameState.revealed[i]) {
          const type = gameState.board[i].split('-')[0];
          cell.classList.add('revealed', type === 'special' ? 'special' : gameState.board[i]);
          cell.innerHTML = `<div class="cell-content">${getIcon(gameState.board[i])}</div>`;

          // Mostrar due√±o
          if (gameState.cellOwners[i] !== null) {
            const dot = document.createElement('div');
            dot.className = 'owner-dot';
            dot.style.background = gameState.players[gameState.cellOwners[i]].color;
            cell.appendChild(dot);
          }
        } else {
          cell.innerHTML = '<div class="cell-content cell-hidden">?</div>';
          cell.addEventListener('click', (e) => {
            e.preventDefault();
            revealCell(i);
          });
        }

        board.appendChild(cell);
      }
    }

    function getIcon(type) {
      if (type === 'aiqar') {
        return `<div class="tire-cell">
          <img src="/tire.png" alt="Llanta" class="tire-image">
          <img src="/aiqar-logo.svg" alt="AIQAR" class="brand-logo">
        </div>`;
      }
      if (type === 'byd') {
        return `<div class="tire-cell">
          <img src="/tire.png" alt="Llanta" class="tire-image">
          <img src="/byd-logo.png" alt="BYD" class="brand-logo">
        </div>`;
      }
      if (type === 'brick') {
        return `<div class="breick-cell">
          <img src="/breick-logo.png" alt="BREICK" class="breick-logo">
        </div>`;
      }
      if (type === 'key-aiqar') return 'üîë';
      if (type === 'key-byd') return 'üîë';
      if (type.startsWith('special-')) {
        const specialId = type.replace('special-', '');
        const special = SPECIAL_TYPES.find(s => s.id === specialId);
        return special ? special.icon : '‚≠ê';
      }
      return '?';
    }

    function revealCell(index) {
      if (gameState.revealed[index] || gameState.gameOver) return;

      gameState.revealed[index] = true;
      gameState.cellOwners[index] = gameState.currentPlayer;

      const item = gameState.board[index];
      const player = gameState.players[gameState.currentPlayer];

      // Procesar item
      if (item === 'aiqar' || item === 'key-aiqar') {
        player.aiqar++;
        checkAiqarWin(player, item);
      } else if (item === 'byd' || item === 'key-byd') {
        player.byd++;
        checkBydWin(player, item);
      } else if (item === 'brick') {
        player.bricks++;
      } else if (item.startsWith('special-')) {
        handleSpecial(item.replace('special-', ''), player);
        return; // Special handles next turn
      }

      renderBoard();
      renderPlayers();
      checkAlerts();

      if (!gameState.gameOver) {
        if (gameState.revealExtra) {
          gameState.revealExtra = false;
          showAlert('üëÄ', 'REVELAR 2', 'Elige otra casilla!');
        } else if (gameState.extraTurn) {
          gameState.extraTurn = false;
          showAlert('üîÑ', 'DOBLE TURNO', 'Juegas otra vez!');
        } else {
          nextTurn();
        }
      }
    }

    function checkAiqarWin(player, item) {
      if (gameState.aiqarWinner) return;

      const wins = gameState.mode === 'ultima' ? item === 'key-aiqar' : player.aiqar >= 4;

      if (wins) {
        gameState.aiqarWinner = gameState.currentPlayer;
        player.prize = 'AIQAR';
        player.protected = true;
        showAlert('üöó', 'GANADOR AIQAR!', `Jugador ${player.number} gano el AIQAR!`);
        checkGameEnd();
      }
    }

    function checkBydWin(player, item) {
      if (gameState.bydWinner) return;

      const wins = gameState.mode === 'ultima' ? item === 'key-byd' : player.byd >= 4;

      if (wins) {
        gameState.bydWinner = gameState.currentPlayer;
        player.prize = 'BYD';
        player.protected = true;
        showAlert('üöó', 'GANADOR BYD!', `Jugador ${player.number} gano el BYD!`);
        checkGameEnd();
      }
    }

    function checkGameEnd() {
      if (gameState.aiqarWinner !== null && gameState.bydWinner !== null) {
        assignVales();
        showFinalResults();
      }
    }

    function assignVales() {
      // Obtener jugadores sin premio
      const remaining = gameState.players
        .map((p, i) => ({ ...p, index: i }))
        .filter(p => !p.protected);

      // Ordenar por: mas llantas de un tipo, total llantas, bricks
      remaining.sort((a, b) => {
        const aMax = Math.max(a.aiqar, a.byd);
        const bMax = Math.max(b.aiqar, b.byd);
        if (bMax !== aMax) return bMax - aMax;

        const aTotal = a.aiqar + a.byd;
        const bTotal = b.aiqar + b.byd;
        if (bTotal !== aTotal) return bTotal - aTotal;

        return b.bricks - a.bricks;
      });

      // Asignar vales
      const vales = ['10,000 Bs', '8,000 Bs', '6,000 Bs'];
      remaining.forEach((p, i) => {
        if (i < vales.length) {
          gameState.players[p.index].prize = vales[i];
        }
      });

      gameState.gameOver = true;
    }

    function showFinalResults() {
      const results = document.getElementById('finalResults');
      results.innerHTML = '';

      // Ordenar por premio
      const prizeOrder = ['AIQAR', 'BYD', '10,000 Bs', '8,000 Bs', '6,000 Bs'];
      const sorted = [...gameState.players].sort((a, b) => {
        return prizeOrder.indexOf(a.prize) - prizeOrder.indexOf(b.prize);
      });

      sorted.forEach((player, i) => {
        const div = document.createElement('div');
        div.className = `result-item pos-${i + 1}`;
        div.innerHTML = `
          <div>
            <span class="result-position">#${i + 1}</span>
            <span class="result-color" style="background:${player.color};">${player.number}</span>
          </div>
          <div class="result-prize">${player.prize}</div>
        `;
        results.appendChild(div);
      });

      document.getElementById('finalModal').classList.add('active');
    }

    function handleSpecial(type, player) {
      const special = SPECIAL_TYPES.find(s => s.id === type);

      renderBoard();
      renderPlayers();

      switch (type) {
        case 'doble':
          gameState.extraTurn = true;
          showAlert(special.icon, special.name, special.desc);
          break;

        case 'revelar2':
          gameState.revealExtra = true;
          showAlert(special.icon, special.name, special.desc);
          break;

        case 'robar':
          executeRobar(player, special);
          break;

        case 'bomba':
          executeBomba(player, special);
          break;

        case 'comodin':
          showComodinChoice(player, special);
          break;

        case 'intercambio':
          executeIntercambio(player, special);
          break;

        case 'espejo':
          executeEspejo(player, special);
          break;

        case 'bloqueo':
          gameState.skipNextPlayer = true;
          showAlert(special.icon, special.name, 'El siguiente jugador perdera su turno!');
          break;
      }
    }

    function getValidTargets() {
      return gameState.players
        .map((p, i) => ({ ...p, index: i }))
        .filter(p => !p.protected && p.index !== gameState.currentPlayer);
    }

    function executeRobar(player, special) {
      const targets = getValidTargets().filter(p => p.aiqar > 0 || p.byd > 0);

      if (targets.length === 0) {
        showAlert(special.icon, special.name, 'No hay nadie a quien robar!');
        nextTurn();
        return;
      }

      const target = targets[Math.floor(Math.random() * targets.length)];
      const targetPlayer = gameState.players[target.index];

      // Elegir tipo al azar
      const types = [];
      if (targetPlayer.aiqar > 0) types.push('aiqar');
      if (targetPlayer.byd > 0) types.push('byd');
      const type = types[Math.floor(Math.random() * types.length)];

      targetPlayer[type]--;
      player[type]++;

      renderPlayers();
      showAlert(special.icon, special.name, `Robaste 1 llanta ${type.toUpperCase()} al Jugador ${targetPlayer.number}!`);

      // Verificar si gano
      if (type === 'aiqar') checkAiqarWin(player, 'aiqar');
      else checkBydWin(player, 'byd');
    }

    function executeBomba(player, special) {
      const types = [];
      if (player.aiqar > 0) types.push('aiqar');
      if (player.byd > 0) types.push('byd');

      if (types.length === 0) {
        showAlert(special.icon, special.name, 'No tenias llantas que perder!');
        nextTurn();
        return;
      }

      const type = types[Math.floor(Math.random() * types.length)];
      const lost = player[type];
      player[type] = 0;

      renderPlayers();
      showAlert(special.icon, special.name, `Perdiste ${lost} llantas ${type.toUpperCase()}!`);
    }

    function showComodinChoice(player, special) {
      const modal = document.getElementById('specialModal');
      document.getElementById('specialIcon').textContent = special.icon;
      document.getElementById('specialTitle').textContent = special.name;
      document.getElementById('specialDesc').textContent = 'Elige que tipo de llanta quieres:';

      const buttons = document.getElementById('specialButtons');
      buttons.innerHTML = `
        <button class="choice-btn aiqar" onclick="applyComodin('aiqar')">üõû AIQAR</button>
        <button class="choice-btn byd" onclick="applyComodin('byd')">üõû BYD</button>
      `;

      modal.classList.add('active');
    }

    window.applyComodin = function(type) {
      document.getElementById('specialModal').classList.remove('active');
      const player = gameState.players[gameState.currentPlayer];
      player[type]++;

      renderPlayers();

      if (type === 'aiqar') checkAiqarWin(player, 'aiqar');
      else checkBydWin(player, 'byd');

      if (!gameState.gameOver) nextTurn();
    };

    function executeIntercambio(player, special) {
      const targets = getValidTargets();

      if (targets.length === 0) {
        showAlert(special.icon, special.name, 'No hay con quien intercambiar!');
        nextTurn();
        return;
      }

      const target = targets[Math.floor(Math.random() * targets.length)];
      const targetPlayer = gameState.players[target.index];

      // Intercambiar
      const tempAiqar = player.aiqar;
      const tempByd = player.byd;
      player.aiqar = targetPlayer.aiqar;
      player.byd = targetPlayer.byd;
      targetPlayer.aiqar = tempAiqar;
      targetPlayer.byd = tempByd;

      renderPlayers();
      showAlert(special.icon, special.name, `Intercambiaste llantas con Jugador ${targetPlayer.number}!`);

      // Verificar si alguien gano
      checkAiqarWin(player, 'aiqar');
      checkBydWin(player, 'byd');
    }

    function executeEspejo(player, special) {
      const targets = getValidTargets();

      if (targets.length === 0) {
        showAlert(special.icon, special.name, 'No hay a quien copiar!');
        nextTurn();
        return;
      }

      const target = targets[Math.floor(Math.random() * targets.length)];
      const targetPlayer = gameState.players[target.index];

      player.aiqar = targetPlayer.aiqar;
      player.byd = targetPlayer.byd;

      renderPlayers();
      showAlert(special.icon, special.name, `Copiaste las llantas del Jugador ${targetPlayer.number}!`);

      checkAiqarWin(player, 'aiqar');
      checkBydWin(player, 'byd');
    }

    function showAlert(icon, title, desc) {
      document.getElementById('alertIcon').textContent = icon;
      document.getElementById('alertTitle').textContent = title;
      document.getElementById('alertDesc').textContent = desc;
      document.getElementById('alertModal').classList.add('active');
    }

    function checkAlerts() {
      const alertBox = document.getElementById('alertBox');

      // Verificar si alguien esta cerca de ganar
      const nearWin = gameState.players.find((p, i) => {
        if (p.protected) return false;
        if (gameState.aiqarWinner === null && p.aiqar === 3) return true;
        if (gameState.bydWinner === null && p.byd === 3) return true;
        return false;
      });

      if (nearWin && gameState.mode !== 'ultima') {
        const type = nearWin.aiqar === 3 ? 'AIQAR' : 'BYD';
        alertBox.textContent = `‚ö†Ô∏è JUGADOR ${nearWin.number} ESTA POR GANAR ${type}! ‚ö†Ô∏è`;
        alertBox.className = 'alert-box active warning';
      } else {
        alertBox.className = 'alert-box';
      }
    }

    function nextTurn() {
      if (gameState.gameOver) return;

      gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;

      // Saltar si esta bloqueado
      if (gameState.skipNextPlayer) {
        gameState.skipNextPlayer = false;
        showAlert('üö´', 'TURNO PERDIDO', `Jugador ${gameState.players[gameState.currentPlayer].number} pierde su turno!`);
        gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
      }

      // Saltar jugadores que ya ganaron
      while (gameState.players[gameState.currentPlayer].protected) {
        gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
      }

      updateCurrentPlayer();
      renderPlayers();
    }

    function updateCurrentPlayer() {
      const badge = document.getElementById('currentPlayerBadge');
      const player = gameState.players[gameState.currentPlayer];
      badge.textContent = player.number;
      badge.style.background = player.color;
    }

    function renderPlayers() {
      const panel = document.getElementById('playersPanel');
      panel.innerHTML = '';

      gameState.players.forEach((player, i) => {
        const card = document.createElement('div');
        let cardClass = 'player-card';
        if (i === gameState.currentPlayer && !player.protected) cardClass += ' active';
        if (player.prize === 'AIQAR') cardClass += ' winner-aiqar';
        else if (player.prize === 'BYD') cardClass += ' winner-byd';
        else if (player.prize) cardClass += ' winner-vale';

        card.className = cardClass;

        card.innerHTML = `
          <div class="player-number" style="background:${player.color};">${player.number}</div>
          <div class="player-stats">
            <div class="stat-item aiqar">
              <img src="/tire.png" class="stat-icon" alt="">
              <span>${player.aiqar}</span>
            </div>
            <div class="stat-item byd">
              <img src="/tire.png" class="stat-icon" alt="">
              <span>${player.byd}</span>
            </div>
            <div class="stat-item breick">
              <span class="stat-icon-text">B</span>
              <span>${player.bricks}</span>
            </div>
          </div>
          ${player.prize ? `<div class="player-prize">üèÜ ${player.prize}</div>` : ''}
        `;
        panel.appendChild(card);
      });
    }

    function resetGame() {
      document.getElementById('finalModal').classList.remove('active');
      document.getElementById('specialModal').classList.remove('active');
      document.getElementById('alertModal').classList.remove('active');
      document.getElementById('gameArea').classList.remove('active');
      document.querySelector('.container').classList.remove('fullscreen');
      document.getElementById('setup').style.display = 'block';
    }
  </script>
</body>
</html>
